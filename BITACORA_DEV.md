# ?? DICCIONARIO DE INFRAESTRUCTURA (CRÃ�TICO)

## GITHUB / ORIGIN (GRATIS)
*   **QuÃ© es:** Repositorio de CÃ³digo Fuente y Archivos EstÃ¡ticos.
*   **Costo:**  (Gratis).
*   **FunciÃ³n:** Guardar versiones del software y backups de emergencia (.sqlite).
*   **Comando:** git push.

## IOWA / TAXI (PAGO)
*   **QuÃ© es:** Instancia SQL Server / Postgres en Google Cloud.
*   **Costo:** c:\dev\Sonido_Liquido_V5 (Por minuto de encendido).
*   **FunciÃ³n:** Motor de Base de Datos productivo para consultas remotas.
*   **Comando:** python scripts/push_seeds_final.py.

> **REGLA DE ORO:** Si IOWA estÃ¡ encendido, es **OBLIGATORIO** correr el script de sincronizaciÃ³n de datos antes de cerrar sesiÃ³n.

---# BitÃƒÂ¡cora de Desarrollo - Sonido LÃƒÂ­quido V5  ## Protocolo de Personalidad (Identidad Gy) *   **Tono:** CÃƒÂ³mplice, Ejecutivo y Resolutivo. Evitar la solemnidad excesiva o la timidez ("Timorata"). *   **Estilo:** "Manos a la obra". Menos disculpas burocrÃƒÂ¡ticas, mÃƒÂ¡s acciÃƒÂ³n tÃƒÂ©cnica. Se valora la proactividad inteligente. *   **Lenguaje:** Uso natural de metÃƒÂ¡foras de operaciÃƒÂ³n, aeronÃƒÂ¡uticas o de misiÃƒÂ³n crÃƒÂ­tica (Ej: "Vuelo 411", "Enceder Motores", "Blindaje", "TriangulaciÃƒÂ³n"). *   **Mindset:** El sistema trabaja para el usuario, no al revÃƒÂ©s. Priorizar la automatizaciÃƒÂ³n y la "Ingesta Inteligente" sobre la carga manual. *   **Idioma:** Toda la comunicaciÃƒÂ³n, bitÃƒÂ¡coras y respuestas al usuario deben ser estrictamente en **ESPAÃƒâ€˜OL (CASTELLANO)**. Prohibido responder en inglÃƒÂ©s salvo para tÃƒÂ©rminos tÃƒÂ©cnicos inevitables.  ## Normas de UX / UI (Doctrina DEOU)  ### 1. Atajos de Teclado Globales *   **F10 (Guardar y Cerrar):** En cualquier formulario o modal de carga (ABM), la tecla `F10` debe actuar como el botÃƒÂ³n "Aceptar" o "Guardar".     *   Si la operaciÃƒÂ³n es exitosa, el modal debe cerrarse automÃƒÂ¡ticamente.     *   Si hay errores de validaciÃƒÂ³n, deben mostrarse y el modal permanecer abierto. *   **F4 (Abrir ABM Relacionado):** Estando posicionado en un campo que referencia a una entidad maestra (ej: Combo de "Transporte", "Ramo", "Vendedor"), la tecla `F4` debe abrir el ABM de dicha entidad en modo "Stacked" (apilado).     *   Al cerrar el ABM apilado (con F10 o Cancelar), el foco debe volver al campo original y la lista debe actualizarse.  ### 2. Comportamiento de Modales *   **Cierre AutomÃƒÂ¡tico:** Tras una operaciÃƒÂ³n exitosa de "Guardar" o "Actualizar", el modal debe cerrarse automÃƒÂ¡ticamente. No deben quedar alertas bloqueantes (alert) que requieran un clic extra del usuario, salvo para errores crÃƒÂ­ticos. *   **Stacked Modals:** Los modales deben soportar la propiedad `isStacked` para renderizarse correctamente cuando son invocados desde otro modal (ej: sin header completo, con botÃƒÂ³n "Volver").  ### 3. Acciones de Listado *   **Baja / EliminaciÃƒÂ³n:** Todos los listados maestros deben incluir una opciÃƒÂ³n explÃƒÂ­cita para "Dar de Baja" o "Eliminar" (generalmente Soft Delete), accesible directamente desde la fila del registro (icono Ã°Å¸â€”â€˜Ã¯Â¸ï¿½).  ### 4. Efecto Lupa (Card Zoom) *   **Estrategia de Contenedor (Wrapper Strategy):** Para implementar el efecto de zoom en tarjetas (hover) sin romper el layout ni causar parpadeos, se debe seguir estrictamente este patrÃƒÂ³n:     1.  **Wrapper Relativo:** La tarjeta debe estar envuelta en un `div` con `position: relative` y una altura mÃƒÂ­nima (`min-height`) definida. Este wrapper es el que ocupa el espacio en la grilla.     2.  **Tarjeta Absoluta:** Al hacer hover, la tarjeta interna cambia a `position: absolute`, `z-index: 50`, y `scale: 1.1` (o similar).     3.  **Anclaje:** La tarjeta absoluta debe tener `top: 0`, `left: 0`, y **`width: 100%`**. Esto asegura que se expanda visualmente pero mantenga el ancho exacto de su columna original (el wrapper), evitando que se expanda a todo el ancho de la pantalla o que se encoja al contenido (causando flicker).     *   *Ejemplo:* Ver implementaciÃƒÂ³n en `HaweView.vue` (Clientes), `TransportesView.vue` o `ContactosView.vue`.  ---  ## Protocolo de Continuidad (Caja Negra)  ### 1. Identidad del Agente Cada entorno de trabajo debe tener un archivo **local** (no versionado) llamado `.gy_identity` en la raÃƒÂ­z del proyecto. *   Contenido: Un cÃƒÂ³digo ÃƒÂºnico de 2-3 letras.     *   `OF`: Oficina (PC Principal)     *   `CA`: Casa (PC Secundaria)     *   `NB`: Notebook / Viaje *   **Importante:** Este archivo debe estar en `.gitignore`.  ### 2. Archivo de Memoria (`MEMORIA_SESIONES.md`) Este archivo actÃƒÂºa como la "Caja Negra" del proyecto. Es un log acumulativo de las sesiones de trabajo. *   **UbicaciÃƒÂ³n:** RaÃƒÂ­z del proyecto. *   **Formato:** Markdown cronolÃƒÂ³gico inverso (SesiÃƒÂ³n mÃƒÂ¡s reciente arriba). *   **Contenido:** ResÃƒÂºmenes de alto nivel, decisiones tomadas, y estado de tareas crÃƒÂ­ticas.  ### 3. GestiÃƒÂ³n de Sesiones (Script `session_manager.py`) Se utiliza el script `scripts/session_manager.py` para automatizar la apertura y cierre de sesiones, aplicando una lÃƒÂ³gica de "Poda Inteligente" para no saturar el archivo.  **LÃƒÂ³gica de RetenciÃƒÂ³n:** 1.  **Cadena Actual:** Mantiene TODAS las sesiones continuas del agente actual (ej: Si Gy OF trabaja lunes, martes y miÃƒÂ©rcoles, se guardan las 3). 2.  **ÃƒÅ¡ltima del Otro:** Mantiene la ÃƒÂºltima sesiÃƒÂ³n registrada por un agente distinto (ej: La ÃƒÂºltima de Gy CA del domingo). 3.  **EslabÃƒÂ³n de Enlace:** Mantiene la ÃƒÂºltima sesiÃƒÂ³n propia *anterior* a la intervenciÃƒÂ³n del otro agente (para dar contexto de quÃƒÂ© estaba haciendo yo antes de que el otro tocara el cÃƒÂ³digo).  ### 4. Procedimiento EstÃƒÂ¡ndar  #### A. Inicio de SesiÃƒÂ³n Al comenzar a trabajar, el agente debe ejecutar: ```bash python scripts/session_manager.py start ``` *   Esto inserta un bloque "EN CURSO" en `MEMORIA_SESIONES.md`. *   El agente debe leer este archivo para obtener contexto inmediato.  #### B. Cierre de SesiÃƒÂ³n Al finalizar (antes de hacer commit/push o cerrar), el agente debe ejecutar: ```bash python scripts/session_manager.py end "Resumen de lo hecho..." ``` *   **Resumen:** Debe ser conciso pero tÃƒÂ©cnico. Mencionar archivos clave tocados y bugs resueltos. *   El script se encargarÃƒÂ¡ de cerrar el bloque, poner la fecha de fin, y podar las sesiones antiguas segÃƒÂºn la lÃƒÂ³gica de retenciÃƒÂ³n.  #### C. ConfiguraciÃƒÂ³n de Nuevo Agente (Ej: Viaje) Si se clona el repo en una nueva mÃƒÂ¡quina: 1.  Crear archivo `.gy_identity` con el cÃƒÂ³digo del nuevo agente (ej: `NB`). 2.  Ejecutar `python scripts/session_manager.py start`. 3.  El sistema reconocerÃƒÂ¡ al nuevo agente y comenzarÃƒÂ¡ a trackear sus sesiones, manteniendo la referencia a OF y CA segÃƒÂºn corresponda.  ### 5. Protocolo de Memoria (RAG) Para garantizar que la "conciencia" del proyecto evolucione, es **obligatorio** actualizar la base de datos vectorial tras hitos importantes.  #### A. CuÃƒÂ¡ndo Indexar *   Al finalizar una sesiÃƒÂ³n de trabajo significativa (como esta). *   Tras completar un mÃƒÂ³dulo nuevo (ej: Rubros, Productos). *   DespuÃƒÂ©s de refactorizaciones grandes.  #### B. Comando de IndexaciÃƒÂ³n ```bash python scripts/index_dev_memory.py ``` *   Este script lee `BITACORA_DEV.md`, `MEMORIA_SESIONES.md` y el cÃƒÂ³digo fuente clave, generando embeddings para futuras consultas.  ---    ### [2025-12-14] Infraestructura de Ventas Fase 2 (Tactical Loader) *   **GestiÃƒÂ³n de "Consumidor Final" (Persistencia CrÃƒÂ­tica):**     *   **SÃƒÂ­ntoma:** El cliente `CONSUMIDOR FINAL` sembrado (`seed_consumidor_final.py`) no persistÃƒÂ­a en la base `pilot.db` tras la ejecuciÃƒÂ³n del script, pese a reportar ÃƒÂ©xito.     *   **DiagnÃƒÂ³stico:** Posible "Silent Rollback" o desconexiÃƒÂ³n de sesiÃƒÂ³n en scripts independientes que no importan todos los modelos (Mappers no inicializados).     *   **SoluciÃƒÂ³n TÃƒÂ©cnica:**         *   Se agregaron todas las importaciones de modelos (`logistica`, `pedidos`, `auth`) al script de seed para asegurar el registro en SQLAlchemy.         *   Se implementÃƒÂ³ una estrategia de **Doble Commit**: Primero vÃƒÂ­a ORM con `db.flush()` y verificaciÃƒÂ³n inmediata. En caso de fallo, **Fallback a SQL Crudo** (`INSERT INTO clientes ...`). *   **Backend Pedidos (Inteligencia):**     *   **Nuevo Endpoint:** `GET /pedidos/last_price/{cliente_id}/{producto_id}`.     *   **Funcionalidad:** Devuelve el ÃƒÂºltimo precio unitario pagado por un cliente para un producto especÃƒÂ­fico, permitiendo al `GridLoader` sugerir precios personalizados en tiempo real.     *   **Refactor:** Se eliminÃƒÂ³ cÃƒÂ³digo duplicado en `backend/pedidos/router.py` (bloques de generaciÃƒÂ³n de Excel redundantes). *   **UX Dashboard Pedidos (`PedidoList`):**     *   **CorrecciÃƒÂ³n SemÃƒÂ¡ntica de Color:** A pedido del usuario, se invirtiÃƒÂ³ la lÃƒÂ³gica de colores de estado:         *   **VERDE (`bg-emerald-50`):** PENDIENTE (En proceso / Espacio de trabajo).         *   **AMARILLO (`bg-yellow-50`):** CUMPLIDO (Finalizado / Alerta de completud).     *   **Filtros:** Se habilitÃƒÂ³ el botÃƒÂ³n/filtro para pedidos "ANULADOS".  *   **Seguridad y Acceso (Auth):**     *   **Incidente:** PÃƒÂ©rdida de acceso admin tras reinicio.     *   **SoluciÃƒÂ³n:** ImplementaciÃƒÂ³n de `seed.py` en arranque (`backend/main.py`) que garantiza existencia de rol `Administrador` y usuario `admin` en desarrollo.     *   **Protocolo:** DocumentaciÃƒÂ³n de recuperaciÃƒÂ³n de contraseÃƒÂ±as. *   **UX/UI Global (Sidebar):**     *   **Refactor:** `AppSidebar.vue` unificado con lÃƒÂ³gica de estado activa real (Router-based).     *   **Theming:** Paletas de colores dinÃƒÂ¡micas por mÃƒÂ³dulo (Azul, BordÃƒÂ³, Ambar). *   **MÃƒÂ³dulo LogÃƒÂ­stica (Transportes):**     *   **Refactor UI:** Inspector con pestaÃƒÂ±as (General / Sedes).     *   **GestiÃƒÂ³n de Sedes:** ImplementaciÃƒÂ³n completa de ABM de Nodos.         *   **Fix Critical Freeze:** CorrecciÃƒÂ³n de bloqueo al crear sedes mediante implementaciÃƒÂ³n de Selector de Provincias (vs Input Manual).         *   **UX:** VisualizaciÃƒÂ³n de Provincias por Nombre y mejora de contraste en selectores (`bg-[#140e03]`).     *   **Nuevos Campos:** `servicio_retiro_domicilio`, prioridad WhatsApp.   ### [2025-12-07] CorrecciÃƒÂ³n CrÃƒÂ­tica: Estabilidad en Modales Anidados (Vue 3 / Teleport) *   **El Problema "Pantalla Blanca" y Syntax Error:**     *   Se presentÃƒÂ³ un error persistente `Invalid end tag` y posteriormente un crash total de la aplicaciÃƒÂ³n.     *   **Causa RaÃƒÂ­z 1 (Sintaxis):** Al mover el componente `CondicionIvaForm` dentro de `ClienteInspector` para mejorar la UX, se generÃƒÂ³ un desbalance de etiquetas `</div>` debido a ediciones parciales inseguras.     *   **Causa RaÃƒÂ­z 2 (Ciclo de Vida):** El componente `CondicionIvaForm` contenÃƒÂ­a un hook `onUpdated` sin importar (`ReferenceError`), lo que causaba el crash runtime.     *   **LecciÃƒÂ³n de Arquitectura (La "Regla de Oro"):**         *   **Regla:** NO anidar componentes modales globales (como ABMs o selectores complejos) dentro de bloques condicionales (`v-if`) profundos de pestaÃƒÂ±as o sub-secciones.         *   **RazÃƒÂ³n:** Si la pestaÃƒÂ±a cambia (`v-if="activeTab === 'general'"` a `contactos`), el componente se destruye. Si ese componente manejaba estado global o estaba abierto, el comportamiento se rompe.         *   **SoluciÃƒÂ³n:** Colocar siempre los componentes modales invocados (`CondicionIvaForm`, `DomicilioForm`) en la **raÃƒÂ­z del template del componente padre**, fuera de cualquier `v-if` condicional de navegaciÃƒÂ³n, controlando su visibilidad puramente con props (`:show`).  *   **ImplementaciÃƒÂ³n (ClienteInspector.vue):**     *   Se reescribiÃƒÂ³ el archivo completo para garantizar la integridad estructural.     *   Se implementÃƒÂ³ `CondicionIvaForm` con prop `initial-view` ('list' o 'form') para soportar tanto gestiÃƒÂ³n general como alta rÃƒÂ¡pida ("Smart ABM").     *   Se aÃƒÂ±adiÃƒÂ³ MenÃƒÂº Contextual (Click Derecho) en el formulario de alta para acceso rÃƒÂ¡pido a ABMs maestros.  ### [2025-12-02] EstabilizaciÃƒÂ³n CrÃƒÂ­tica Backend y UI Productos (SesiÃƒÂ³n Nocturna) *   **Backend (Correcciones CrÃƒÂ­ticas):**     *   **Inconsistencia de Base ORM:** Se unificaron todas las importaciones de `Base` a `backend.core.database` (antes habÃƒÂ­a mezcla con `core.database`), lo que causaba que SQLAlchemy no resolviera las relaciones entre modelos (`InvalidRequestError`, `NoReferencedTableError`).     *   **MÃƒÂ³dulo Rubros:** Se eliminaron referencias obsoletas en `main.py` y se moviÃƒÂ³ la lÃƒÂ³gica al router de `productos`, aÃƒÂ±adiendo endpoints faltantes (`PUT`, `DELETE`).     *   **Schemas Industriales:** Se actualizaron los schemas Pydantic de Productos para incluir los nuevos campos (`unidad_stock_id`, `tasa_iva_id`, etc.) que estaban siendo ignorados al guardar.     *   **AI Client:** Se identificÃƒÂ³ que el error de `BaseApiClient` es un efecto secundario no bloqueante de la falta de credenciales. *   **Frontend (Productos):**     *   **NavegaciÃƒÂ³n:** Se corrigieron los enlaces muertos en `AppSidebar.vue` para Productos y Maestros.     *   **InicializaciÃƒÂ³n:** Se corrigiÃƒÂ³ `createNew` en `ProductosView.vue` para inicializar correctamente los campos industriales, evitando errores al abrir el inspector.     *   **DiseÃƒÂ±o:** Se ajustÃƒÂ³ el color de fondo de `ProductosView.vue` a `#1a050b` para coincidir con el panel inspector, segÃƒÂºn solicitud de diseÃƒÂ±o.  ### [2025-12-02] Infraestructura Satelital (Proveedores, DepÃƒÂ³sitos, Maestros) *   **Nuevo MÃƒÂ³dulo Proveedores:**     *   Modelo `Proveedor` (Clon de Cliente).     *   API CRUD operativa (`/proveedores`). *   **LogÃƒÂ­stica:**     *   Nuevo modelo `Deposito` (FÃƒÂ­sico, Virtual, MÃƒÂ³vil).     *   Seed inicial: DepÃƒÂ³sito "CENTRAL". *   **Maestros:**     *   Nuevas tablas `Unidades` (UN, L, KG, etc.) y `TasasIVA` (21%, 10.5%, etc.). *   **Refactor Productos:**     *   IntegraciÃƒÂ³n de lÃƒÂ³gica industrial: `proveedor_habitual`, `tasa_iva`, `unidad_stock`, `unidad_compra`, `factor_compra`.     *   CorrecciÃƒÂ³n de relaciÃƒÂ³n recursiva en `Rubros` (uso correcto de `backref`). *   **Infraestructura:**     *   Script `init_satellites_db.py` ejecutado exitosamente.  ### [2025-12-02] ImplementaciÃƒÂ³n UI Productos (Fase 2B - OperaciÃƒÂ³n Tinto Profundo) *   **Identidad Visual:**     *   Fondo `bg-[#2e0a13]` (BordÃƒÂ³ oscuro) para diferenciar del mÃƒÂ³dulo Clientes.     *   TÃƒÂ­tulos y acentos en `text-rose-400`. *   **Componentes:**     *   `ProductosView.vue`: Layout trÃƒÂ­ptico (Sidebar | Lista | Inspector).     *   `ProductoCard.vue`: Tarjeta con SKU, CÃƒÂ³digo Visual (Badge) e indicador de Kit.     *   `ProductoInspector.vue`: Panel de ediciÃƒÂ³n con PestaÃƒÂ±as (General / Costos) y Simulador de Precios en tiempo real. *   **UX:**     *   Buscador global (F3).     *   Filtros por Rubro (Select jerÃƒÂ¡rquico) y Estado.     *   Atajo F10 para guardar.  ### [2025-12-02] ImplementaciÃƒÂ³n Frontend Productos (Fase 2A - LÃƒÂ³gica) *   **Servicios API:**     *   `rubrosApi.js`: CRUD estÃƒÂ¡ndar.     *   `productosApi.js`: CRUD con filtros y toggle de estado. *   **State Management (Pinia):**     *   `stores/productos.js`: Store centralizado con manejo de filtros, carga de datos y notificaciones (`useNotificationStore`).     *   IntegraciÃƒÂ³n de lÃƒÂ³gica de negocio para creaciÃƒÂ³n, ediciÃƒÂ³n y baja lÃƒÂ³gica.  ### [2025-12-02] ImplementaciÃƒÂ³n Backend Productos (V5) *   **Estructura de Base de Datos:**     *   `Rubros`: JerarquÃƒÂ­a recursiva (padre-hijo).     *   `Productos`: Maestro con SKU (secuencia 10000+), CÃƒÂ³digo Visual, Unidad de Medida, Kit.     *   `ProductosCostos`: Tabla satÃƒÂ©lite para precios y costos (1-to-1). *   **API:**     *   Router `/productos` implementado con CRUD bÃƒÂ¡sico.     *   Schemas con cÃƒÂ¡lculo de precios (Mayorista, Distribuidor, Minorista) en lectura. *   **Infraestructura:**     *   Script `init_productos_db.py` para creaciÃƒÂ³n de tablas.     *   IntegraciÃƒÂ³n en `main.py`.  ### [2025-12-01] EstandarizaciÃƒÂ³n de Layouts y TerminologÃƒÂ­a *   **Layout Unificado:** Se estandarizÃƒÂ³ el diseÃƒÂ±o de los mÃƒÂ³dulos `Transportes` y `Contactos` para que coincidan con `Clientes`:     *   **Sidebar Izquierdo:** MenÃƒÂº de navegaciÃƒÂ³n persistente.     *   **Contenido Central:** Listado de registros.     *   **Inspector Derecho:** Panel fijo (320px) para ediciÃƒÂ³n/creaciÃƒÂ³n, siempre visible (con placeholder cuando no hay selecciÃƒÂ³n). *   **TerminologÃƒÂ­a LogÃƒÂ­stica:**     *   Se renombrÃƒÂ³ "DepÃƒÂ³sitos" a **"DepÃƒÂ³sitos Internos"** en el menÃƒÂº lateral para diferenciar los almacenes propios de la empresa de los domicilios de entrega de los clientes.     *   *Pendiente de revisiÃƒÂ³n:* Evaluar si el tÃƒÂ©rmino sigue siendo ambiguo. *   **CorrecciÃƒÂ³n de Bugs:**     *   **Ghost Screen:** Se solucionÃƒÂ³ el parpadeo del layout antiguo al recargar la pÃƒÂ¡gina (`Ctrl+F5`) implementando un estado de carga (`ready`) en `App.vue` que espera a que el router estÃƒÂ© listo.  ### [2025-11-30] NavegaciÃƒÂ³n Domicilios y ABM Transportes *   **Domicilios (UX):**     *   **NavegaciÃƒÂ³n por Teclado:** Se implementÃƒÂ³ navegaciÃƒÂ³n con flechas Arriba/Abajo en la lista de domicilios (`DomicilioGrid`).     *   **Looping:** La navegaciÃƒÂ³n es circular (del ÃƒÂºltimo al primero y viceversa).     *   **Foco:** Se aÃƒÂ±adiÃƒÂ³ `tabindex="0"` y feedback visual para indicar la tarjeta activa. *   **Transportes (Hawe):**     *   **ABM Completo:** Se implementÃƒÂ³ la gestiÃƒÂ³n completa de Transportes en `HaweTransportesView.vue`.     *   **Funcionalidad:** Alta, Baja (Soft Delete), ModificaciÃƒÂ³n y Listado.     *   **Campos:** Nombre, TelÃƒÂ©fono Reclamos, Web Tracking, Activo, Requiere Carga Web, Formato Etiqueta.     *   **IntegraciÃƒÂ³n:** Conectado a `useLogisticaStore` y `useNotificationStore`. *   **UI/UX:**     *   **ClientCanvas:** Se separÃƒÂ³ el encabezado "LogÃƒÂ­stica & Contactos" en dos secciones independientes: "LOGÃƒï¿½STICA" y "CONTACTOS" para mayor claridad visual.     *   **Estilo de TÃƒÂ­tulos:** Se aplicÃƒÂ³ un diseÃƒÂ±o destacado (texto cyan, fondo sutil, borde) a los tÃƒÂ­tulos de secciÃƒÂ³n en el panel derecho.     *   **Fondo Global:** Se cambiÃƒÂ³ el color de fondo principal de Negro (`#0a0a0a`) a Azul Profundo (`#0a1f2e`) para alinear con la identidad del mÃƒÂ³dulo Clientes.     *   **Listas de GestiÃƒÂ³n:** Se estandarizÃƒÂ³ el diseÃƒÂ±o de "Administrar Segmentos" y se creÃƒÂ³ "Administrar Domicilios" con tema oscuro, bÃƒÂºsqueda y acciones con ÃƒÂ­conos, accesibles desde el menÃƒÂº contextual. *   **Limpieza de Proyecto:**     *   **EliminaciÃƒÂ³n de Legacy:** Se eliminaron las carpetas `views/Clientes` y `views/Logistica` que contenÃƒÂ­an cÃƒÂ³digo obsoleto.     *   **Router:** Se limpiaron las rutas antiguas `/clientes` y `/transportes`, centralizando todo en el mÃƒÂ³dulo `Hawe`. *   **Correcciones y Mejoras:**     *   **Iconos:** Se actualizaron todos los iconos a `fa-solid` (FontAwesome 6) para solucionar problemas de visualizaciÃƒÂ³n en listas y formularios.     *   **ProtecciÃƒÂ³n Fiscal:** Se implementÃƒÂ³ la lÃƒÂ³gica para impedir el borrado de domicilios fiscales en `DomicilioList.vue`.     *   **Consistencia UI:**         *   Se renombrÃƒÂ³ "Maestro de Segmentos" a "Administrar Segmentos".         *   Se habilitÃƒÂ³ el **doble click** en los tÃƒÂ­tulos "SEGMENTOS" (en `ClientCanvas.vue` y en el sidebar de `HaweView.vue`) y "LOGÃƒï¿½STICA" para abrir sus respectivas ventanas de administraciÃƒÂ³n.         *   Se restauraron los **iconos** (LÃƒÂ¡piz y Tacho) en las listas, asegurando su visibilidad con colores de alto contraste (`text-cyan-400` y `text-red-400`) y usando las clases mÃƒÂ¡s compatibles `fa-solid fa-pencil` y `fa-solid fa-trash` con dimensiones explÃƒÂ­citas (`w-4 h-4`).     *   **CorrecciÃƒÂ³n de Bug:** Se solucionÃƒÂ³ un error de sintaxis en `ClientCanvas.vue` (etiqueta `<aside>` mal cerrada) que surgiÃƒÂ³ durante la refactorizaciÃƒÂ³n.     *   **Infraestructura:** Se instalÃƒÂ³ **FontAwesome localmente** (`npm install @fortawesome/fontawesome-free`) y se eliminÃƒÂ³ la dependencia del CDN para garantizar que los iconos funcionen offline y sin bloqueos de navegador (Brave Shields, AdBlockers).     *   **Mejoras en DomicilioList:**         *   **Filtros:** Se agregaron los filtros "Todos / Activos / Inactivos".         *   **EdiciÃƒÂ³n:** Ahora al hacer click en el lÃƒÂ¡piz, se cierra la lista y se abre correctamente la pestaÃƒÂ±a de ediciÃƒÂ³n del domicilio seleccionado.         *   **Baja LÃƒÂ³gica (Soft Delete):** Se implementÃƒÂ³ la baja lÃƒÂ³gica para domicilios.             *   **Backend:** Se agregÃƒÂ³ la columna `activo` a la tabla `domicilios` mediante script de migraciÃƒÂ³n.             *   **Frontend:** La lista de domicilios ahora permite filtrar por estado.     *   **Mejoras en DomicilioForm:**         *   **Toggle Activo:** Se agregÃƒÂ³ un interruptor para activar/desactivar domicilios desde la ediciÃƒÂ³n.  ### [2025-11-30] RefactorizaciÃƒÂ³n LogÃƒÂ­stica y Domicilios (Tabs) *   **Cambio ArquitectÃƒÂ³nico:**     *   **Interfaz por PestaÃƒÂ±as:** Se reemplazÃƒÂ³ el uso de modales flotantes por un sistema de pestaÃƒÂ±as (`CLIENTE`, `DOMICILIO`, `CONTACTO`) integrado en el canvas central de `ClientCanvas.vue`.     *   **DomicilioForm:** ConversiÃƒÂ³n de componente modal a componente de canvas, con botones "Volver" y "Guardar" integrados. *   **UX/UI:**     *   **Sidebar LogÃƒÂ­stica:** Botones "FICHA - NUEVO" siempre visibles en cabecera de Domicilios.     *   **MenÃƒÂº Contextual:** Implementado en cabecera de Domicilios (Nuevo, Administrar) y en tarjetas individuales (Editar, Eliminar).     *   **NavegaciÃƒÂ³n:** Doble clic en tarjeta de domicilio abre la pestaÃƒÂ±a de ediciÃƒÂ³n correspondiente. *   **CorrecciÃƒÂ³n de Bugs:**     *   **InicializaciÃƒÂ³n Formulario:** Se corrigiÃƒÂ³ bug donde el doble clic abrÃƒÂ­a el formulario de alta en lugar de ediciÃƒÂ³n (watcher de `domicilio` con `immediate: true`).  ### [2025-11-29] ReplicaciÃƒÂ³n de MenÃƒÂº Contextual y ABM Maestros *   **Backend (Maestros):**     *   ImplementaciÃƒÂ³n de CRUD completo (API + Schemas) para `Provincias`, `CondicionesIva` y `TiposContacto`.     *   ValidaciÃƒÂ³n de integridad referencial y manejo de errores. *   **Frontend (Context Menu):**     *   **Componente Reutilizable:** CreaciÃƒÂ³n de `ContextMenu.vue` para uso global.     *   **Dashboard (HaweView):**         *   IntegraciÃƒÂ³n en lista lateral de "Segmentos" (Editar/Borrar).         *   IntegraciÃƒÂ³n en tarjetas de "Clientes" (Nueva Ficha, Administrar, Editar, Baja, IA).         *   IntegraciÃƒÂ³n en enlace "Clientes" del sidebar (Nuevo, Administrar).     *   **ClientCanvas:**         *   IntegraciÃƒÂ³n en etiqueta "Segmento" del formulario (Nuevo, Administrar). *   **UI/UX Refinements:**     *   **NavegaciÃƒÂ³n:** CorrecciÃƒÂ³n de flujo entre "Fichas", "Nuevo Cliente" y Dashboard.     *   **Estilos:** RediseÃƒÂ±o de botones en cabecera de ficha para evitar confusiÃƒÂ³n (Fichas resaltado, Nuevo sutil).     *   **Feedback:** Mejoras en la indicaciÃƒÂ³n visual de contexto.  ### [2025-11-27] Agenda y UX Avanzada (SesiÃƒÂ³n Nocturna) *   **MÃƒÂ³dulo Agenda:**     *   **Fix "Desconocido":** Se corrigiÃƒÂ³ el schema del backend para incluir datos de la persona en la respuesta del vÃƒÂ­nculo.     *   **EdiciÃƒÂ³n:** Se implementÃƒÂ³ la funcionalidad completa de ediciÃƒÂ³n de contactos (PUT) con botÃƒÂ³n dedicado.     *   **Roles al Vuelo:** ImplementaciÃƒÂ³n de creaciÃƒÂ³n de "Tipos de Contacto" directamente desde el formulario (F4). *   **UX Premium:**     *   **CopyTooltip:** Componente estilo "Gmail" para Email y WhatsApp. Al pasar el mouse, muestra el dato completo y permite copiarlo con un clic.     *   **WhatsApp Input:** Campo inteligente con prefijo automÃƒÂ¡tico (+54 9) y limpieza de basura. *   **Correcciones:**     *   **Fix 422:** SanitizaciÃƒÂ³n de payloads para evitar errores de validaciÃƒÂ³n con campos vacÃƒÂ­os.     *   **Fix Top Clients:** Se blindÃƒÂ³ el schema de `ClienteResponse` para tolerar valores nulos en `saldo` y `contador_uso`, recuperando la lista de frecuentes.     *   **Fix Import:** CorrecciÃƒÂ³n de referencia circular/errÃƒÂ³nea en `backend/clientes/router.py`.  ### [2025-11-27] Pulido de Clientes y Domicilios *   **CorrecciÃƒÂ³n de Bugs CrÃƒÂ­ticos:**     *   **Crash Frontend:** Solucionado `ReferenceError: onUnmounted` en `DomicilioGrid`.     *   **Error de Guardado:** Se eliminÃƒÂ³ el campo `zona_id` del payload de Domicilios ya que no existÃƒÂ­a en el modelo, permitiendo guardar direcciones con "S/N". *   **UX Domicilios:**     *   **Dashboard:** VisualizaciÃƒÂ³n en tiempo real de domicilios en la pestaÃƒÂ±a "General" (sin recarga).     *   **LÃƒÂ³gica de Transporte:**         *   **Auto-relleno:** Al crear un nuevo destino, copia el transporte del Domicilio Fiscal.         *   **Fallback:** Si se deja vacÃƒÂ­o, asigna automÃƒÂ¡ticamente "Retiro en Local" (o el primero disponible) al guardar.         *   **F10:** Se corrigiÃƒÂ³ la captura de tecla para que F10 guarde el modal de domicilio si estÃƒÂ¡ abierto.     *   **VisualizaciÃƒÂ³n:** Se filtrÃƒÂ³ el Domicilio Fiscal de la lista de entregas para evitar duplicados y conteo errÃƒÂ³neo.  ### [2025-11-25] RefactorizaciÃƒÂ³n Ramo -> Segmento *   **Cambio SemÃƒÂ¡ntico:** Se renombrÃƒÂ³ la entidad "Ramo" a "Segmento" en todo el sistema (Base de Datos, Backend, Frontend, DocumentaciÃƒÂ³n) para evitar ambigÃƒÂ¼edades con el concepto de "Rubro" de productos. *   **CorrecciÃƒÂ³n de Bugs:**     *   SoluciÃƒÂ³n a crash del Backend por error en Router de Maestros.     *   CorrecciÃƒÂ³n en mÃƒÂ³dulo Agenda (Personas): Se visualizaban como "Inactivos" por falta del campo `activo` en el schema de respuesta de la API. *   **UI Standard:** AlineaciÃƒÂ³n de filtros "Todos/Activos/Inactivos" a la derecha en todos los listados para consistencia con el mÃƒÂ³dulo Clientes.     *   Se actualizÃƒÂ³ `ClienteService` para propagar el transporte seleccionado en la ficha del cliente hacia su domicilio predeterminado (Fiscal/Entrega). *   **Frontend (ClienteForm):**     *   **Tab 1 (General):** IntegraciÃƒÂ³n de campos de domicilio legal para alta rÃƒÂ¡pida. CreaciÃƒÂ³n automÃƒÂ¡tica de domicilio Fiscal/Entrega al guardar.     *   **Transporte:** Campo obligatorio (con asterisco rojo). Se preselecciona "RETIRO EN LOCAL" si no hay otro.     *   **Persistencia:** Solucionado bug donde el transporte no se guardaba/recuperaba correctamente en clientes existentes. *   **SmartSelect:**     *   Soporte para propiedad `required` (asterisco rojo).     *   CorrecciÃƒÂ³n de "Race Condition" que borraba el valor seleccionado al cargar la lista asincrÃƒÂ³nicamente o al hacer click fuera prematuramente. *   **Base de Datos:**     *   Script de migraciÃƒÂ³n (`fix_legacy_transportes.py`) para asignar "RETIRO EN LOCAL" a todos los domicilios legados que no tenÃƒÂ­an transporte asignado.  ### [2025-11-25] EstandarizaciÃƒÂ³n UX Global (Norma DEOU) *   **ImplementaciÃƒÂ³n Masiva:** Se aplicaron las normas de atajos y comportamiento en todos los mÃƒÂ³dulos (Transportes, Ramos, Vendedores, Listas, Personas, Clientes).     *   `F10`: Guardar y Cerrar.     *   `F4`: Nuevo registro (en listados).     *   `Papelera`: BotÃƒÂ³n de baja lÃƒÂ³gica en listados. *   **Refactor TÃƒÂ©cnico:** CreaciÃƒÂ³n de composable `useKeyboardShortcuts` para manejo centralizado de eventos. *   **Base de Datos:** MigraciÃƒÂ³n para agregar campo `activo` a la tabla `personas`.  ### [2025-11-25] OperaciÃƒÂ³n ConstelaciÃƒÂ³n (Maestros SatÃƒÂ©lites) *   ImplementaciÃƒÂ³n de mÃƒÂ³dulos: Ramos, Vendedores, Listas de Precios, Agenda. *   Seed de transporte virtual "RETIRO EN LOCAL" (ID 1). *   Ajuste de UX en Transportes: Cierre automÃƒÂ¡tico de modal al guardar y botÃƒÂ³n de Baja.  ## [2025-12-05] RefactorizaciÃƒÂ³n UI Rubros y ProtecciÃƒÂ³n de Datos ### Cambios Realizados - **Frontend (RubrosView.vue):**   - ImplementaciÃƒÂ³n del patrÃƒÂ³n "Explorador + Inspector" (Bridge UI).   - Cabecera con filtros de estado (Todos/Activos/Inactivos) y bÃƒÂºsqueda.   - MenÃƒÂº de ordenamiento completo (A-Z, Z-A, Antiguos, Recientes).   - Toggle de "Baja RÃƒÂ¡pida" con confirmaciÃƒÂ³n en caso de desactivaciÃƒÂ³n.   - Inspector lateral siempre visible con "Empty State". - **Backend (productos/router.py):**   - Agregada validaciÃƒÂ³n en el endpoint `PUT /rubros/{id}`.   - **Regla de Negocio:** No se puede desactivar un rubro si tiene hijos activos o productos asociados activos.  ### Pendientes Identificados - **GestiÃƒÂ³n de Dependencias:** Se requiere una herramienta para reasignar hijos/productos cuando se desea eliminar un rubro padre (Wizard de ReasignaciÃƒÂ³n).  ### [2025-12-05] RefactorizaciÃƒÂ³n UI Clientes y Theming (SesiÃƒÂ³n Tarde) *   **Refactor UI Clientes:**     *   **Explorador + Inspector:** Se migrÃƒÂ³ `HaweView.vue` al patrÃƒÂ³n de lista izquierda y panel derecho (`ClienteInspector.vue`), eliminando la navegaciÃƒÂ³n a pantalla completa (`ClientCanvas`).     *   **Funcionalidad:** Alta, Baja (Soft Delete), ModificaciÃƒÂ³n y Listado integrados en el nuevo layout.     *   **Fix Sidebar:** Se eliminÃƒÂ³ la duplicaciÃƒÂ³n del menÃƒÂº lateral en `TransportesView.vue`. *   **Theming DinÃƒÂ¡mico:**     *   **Sidebar:** `AppSidebar.vue` ahora adapta su color de fondo y bordes segÃƒÂºn el mÃƒÂ³dulo activo (Azul para Clientes, Rosa para Rubros, Naranja para Transportes).     *   **Paleta Clientes:** Se implementÃƒÂ³ un tema "Cian/Azul Noche" (`#081c26`, `#05151f`) para diferenciarlo visualmente de otros mÃƒÂ³dulos, manteniendo la consistencia de contraste y luminosidad. *   **Correcciones:**     *   **Sintaxis:** Se corrigiÃƒÂ³ un error de cierre de etiquetas en `HaweView.vue`.     *   **Visibilidad:** Se ajustaron los colores de fondo del sidebar para que el tinte de color sea claramente perceptible.  ### [2025-12-06] ImplementaciÃƒÂ³n Toggle Status en Listado Clientes *   **Feature (Hawe):**     *   **Toggle en Lista:** Se agregÃƒÂ³ el interruptor (deslizador) de estado Activo/Inactivo a la vista de lista (renglones) del Explorador de Clientes (`HaweView.vue`).     *   **LÃƒÂ³gica Unificada:** Se creÃƒÂ³ la funciÃƒÂ³n `toggleClienteStatus` para manejar el cambio de estado tanto en la vista de CuadrÃƒÂ­cula como en la de Lista.     *   **Regla de Negocio:**         *   **Activar:** AcciÃƒÂ³n inmediata (sin confirmaciÃƒÂ³n).         *   **Desactivar:** Requiere confirmaciÃƒÂ³n del usuario ("Ã‚Â¿EstÃƒÂ¡ seguro...?").     *   **Fix Bug:** Se corrigiÃƒÂ³ el comportamiento de los botones toggle en la vista de Fichas, que anteriormente llamaban a `handleInspectorDelete` forzando siempre la desactivaciÃƒÂ³n, lo que impedÃƒÂ­a reactivar clientes desde la UI.  ### [2025-12-06] CorrecciÃƒÂ³n CrÃƒÂ­tica: Alta de Clientes y Domicilios *   **Problema:** Bloqueo en el flujo de alta (`Deadlock UX`). La regla de negocio exige un domicilio fiscal para crear el cliente, pero la UI obligaba a crear el cliente antes de habilitar la carga de domicilios. *   **SoluciÃƒÂ³n (ClienteInspector):**     *   **Alta RÃƒÂ¡pida (Smart Form):** Se integrÃƒÂ³ un sub-formulario de "Domicilio Fiscal" en la pestaÃƒÂ±a General, visible solo durante la creaciÃƒÂ³n (`isNew`).     *   **ValidaciÃƒÂ³n:** Se impide guardar si falta direcciÃƒÂ³n, localidad o provincia.     *   **Payload:** Se empaqueta el domicilio fiscal dentro de la peticiÃƒÂ³n de creaciÃƒÂ³n del cliente (`nested write`). *   **CorrecciÃƒÂ³n de Datos (Clientes Rotos):**     *   Se habilitÃƒÂ³ la funcionalidad "Agregar Domicilio" en el inspector de ediciÃƒÂ³n. Ahora abre un formulario superpuesto (`DomicilioForm` overlay) que permite sanear clientes antiguos que quedaron sin direcciÃƒÂ³n ("sembrados incorrectamente").     *   Se implementÃƒÂ³ la lÃƒÂ³gica `handleDomicilioSaved` para persistir los cambios inmediatamente en el backend sin depender del guardado del cliente padre. *   **Maestros:**     *   Se conectÃƒÂ³ el selector de "CondiciÃƒÂ³n IVA" con el store de maestros dinÃƒÂ¡mico, reemplazando las opciones hardcodeadas que causaban inconsistencias.     *   Se asegurÃƒÂ³ la carga de Provincias y Transportes al abrir el inspector.  ### [2025-12-06] ImplementaciÃƒÂ³n CUIT Multi-Sede y Consistencia de Datos *   **Backend (Integridad de Datos):**     *   **EliminaciÃƒÂ³n Constraint UNIQUE:** Se eliminÃƒÂ³ la restricciÃƒÂ³n ÃƒÂºnica en el campo `cuit` de la tabla `clientes` para permitir mÃƒÂºltiples sucursales/facultades bajo el mismo CUIT institucional.     *   **Endpoint de VerificaciÃƒÂ³n:** Nueva lÃƒÂ³gica `check_cuit` que detecta duplicados y devuelve metadatos (RazÃƒÂ³n Social + Domicilio Principal) para asistir en la decisiÃƒÂ³n.     *   **SanitizaciÃƒÂ³n de Datos:** EjecuciÃƒÂ³n de script `fix_existing_cuits.py` que corrigiÃƒÂ³ dÃƒÂ­gitos verificadores invÃƒÂ¡lidos en la base de datos heredada. *   **Frontend (ClienteInspector UX):**     *   **ValidaciÃƒÂ³n Inteligente:** ValidaciÃƒÂ³n de CUIT (Algoritmo Modulo 11) en tiempo real (`@blur`).     *   **Alerta de Duplicados:** Sistema de advertencia no bloqueante (Amarillo) que lista las sedes existentes.         *   **AcciÃƒÂ³n "Switch":** Doble click en un ÃƒÂ­tem carga el cliente existente (Modo EdiciÃƒÂ³n).         *   **AcciÃƒÂ³n "Nueva Sede":** BotÃƒÂ³n explÃƒÂ­cito para confirmar la creaciÃƒÂ³n de una nueva sucursal y descartar la advertencia.     *   **Correcciones Visuales:** Asterisco rojo en campos obligatorios, limpieza de anidamiento HTML excesivo.     *   **Estado del Panel:** ImplementaciÃƒÂ³n de encabezado persistente ("Inspector") y manejo correcto del estado "VacÃƒÂ­o" post-guardado. *   **GestiÃƒÂ³n de Maestros (CondiciÃƒÂ³n IVA):**     *   **Refactor a Manager:** ConversiÃƒÂ³n del formulario simple de CondiciÃƒÂ³n IVA a un **ABM Completo** (Lista, BÃƒÂºsqueda, Alta, EdiciÃƒÂ³n, Baja) integrado en el flujo de alta de clientes.     *   **Tech:** Uso de `<Teleport to="body">` para resolver problemas de apilamiento (z-index) con el backdrop del sidebar. *   **Estrategia Futura (ARCA/AFIP):**     *   Se definiÃƒÂ³ la estrategia para la facturaciÃƒÂ³n electrÃƒÂ³nica: "Offline First". Alta flexible con bandera de "VerificaciÃƒÂ³n Pendiente", conciliaciÃƒÂ³n asÃƒÂ­ncrona con padrÃƒÂ³n ARCA cuando haya conexiÃƒÂ³n, y uso de "Consumidor Final" como fallback temporal.  ### [2025-12-06] Estrategia de Carga Inicial (Golden Master) *   **DecisiÃƒÂ³n:** Se optÃƒÂ³ por una carga diferida mediante **Plantillas CSV/Excel** en lugar de dar acceso directo al sistema en desarrollo.     *   **Beneficio:** Permite avanzar con la carga real de datos de forma paralela sin "ensuciar" el entorno de desarrollo ni exponer al operador a cambios continuos.     *   **ImplementaciÃƒÂ³n Futura:** Se desarrollarÃƒÂ¡ un script de "ImportaciÃƒÂ³n Masiva" para ingestar estos CSV cuando el sistema alcance su versiÃƒÂ³n Release Candidate. *   **Requisito de SanitizaciÃƒÂ³n (CUIT):**     *   La herramienta de importaciÃƒÂ³n (y el sistema en general) debe ser **permisiva en la entrada** pero **estricta en el almacenamiento**.     *   **Caso de Uso:** El operador copia y pega CUITs desde Ãƒâ€œrdenes de Compra (PDFs/Mails) que suelen tener guiones, barras o espacios (Ej: `30-11223344-6`).     *   **AcciÃƒÂ³n:** El sistema debe limpiar automÃƒÂ¡ticamente estos caracteres (`strip`) y guardar solo los 11 dÃƒÂ­gitos numÃƒÂ©ricos, ahorrando tiempo de ediciÃƒÂ³n manual al usuario. (Nota: Esto ya estÃƒÂ¡ parcialmente implementado en el Frontend `ClienteInspector`).  ### [2025-12-06] DefiniciÃƒÂ³n EstratÃƒÂ©gica: V5 como Producto y Data Intelligence Durante una sesiÃƒÂ³n de planificaciÃƒÂ³n conceptual ("Charla de Sistemas"), se pergeÃƒÂ±aron los siguientes pilares para el futuro del proyecto:  1.  **VisiÃƒÂ³n Comercial de Sonido LÃƒÂ­quido V5:**     *   **El Nicho:** No competir contra ERPs contables, sino ofrecer una soluciÃƒÂ³n para "el que no piensa en sistemas".     *   **La Diferencia:** Un sistema que piensa por el usuario. "Sacale una foto a tu cuaderno y yo te ordeno el pedido".     *   **Feature Star:** La capacidad de ingerir el caos (Excel, PDFs, Fotos) y devolver orden sin carga manual.  2.  **Estrategia de MigraciÃƒÂ³n "Smart Merge" (ARCA + Excel):**     *   **El Problema:** El Excel interno de pedidos tiene datos ricos pero sucios (nombres informales). ARCA (AFIP) tiene datos fiscales perfectos pero frÃƒÂ­os.     *   **La SoluciÃƒÂ³n:** TriangulaciÃƒÂ³n de datos.         *   Si en el Excel dice "LÃƒÂ¡cteos Poblet - 4 cajas" el 12/03 por $10.000...         *   Y en ARCA hay una factura a "Poblet S.A." el 13/03 por $10.000...         *   **Match:** El sistema infiere que el cliente informal corresponde a ese CUIT oficial.     *   **Resultado:** ConstrucciÃƒÂ³n automÃƒÂ¡tica de una Base de Clientes V5 depurada y enriquecida con historial fiscal real.   ### [2025-12-07] ConsolidaciÃƒÂ³n de Maestros y UX Avanzada *   **CorrecciÃƒÂ³n de Infraestructura:**     *   **ConexiÃƒÂ³n DB:** Se resolviÃƒÂ³ el error `FATAL: password authentication failed` identificando una contraseÃƒÂ±a desactualizada en el cÃƒÂ³digo de fallback (`backend/core/database.py`) y en el servidor PostgreSQL. Se unificÃƒÂ³ la credencial a la correcta.     *   **CORS:** Se ajustÃƒÂ³ la polÃƒÂ­tica CORS para permitir el desarrollo local y depuraciÃƒÂ³n segura. *   **PotenciaciÃƒÂ³n de Maestros (ABM CondiciÃƒÂ³n IVA):**     *   **API Usage check:** CreaciÃƒÂ³n de endpoint `GET .../usage` para verificar dependencias antes del borrado.     *   **Wizard de MigraciÃƒÂ³n:** ImplementaciÃƒÂ³n de un asistente visual que intercepta el borrado de condiciones en uso.         *   Muestra conteo y ejemplos de clientes afectados.         *   Permite **Reasignar** masivamente a otra condiciÃƒÂ³n existente.         *   Permite **Crear y Reasignar** a una nueva condiciÃƒÂ³n en el mismo flujo.     *   **Auto-Merge (UnificaciÃƒÂ³n):** DetecciÃƒÂ³n de duplicados por nombre al editar. Ofrece fusionar el registro actual con el existente, migrando automÃƒÂ¡ticamente los clientes. *   **CorrecciÃƒÂ³n de Calidad de Datos (ClienteInspector):**     *   **ValidaciÃƒÂ³n Estricta:** Se extendiÃƒÂ³ la validaciÃƒÂ³n de campos obligatorios (RazÃƒÂ³n Social, CUIT, Segmento, CondiciÃƒÂ³n IVA) tambiÃƒÂ©n a la **ediciÃƒÂ³n** de clientes, evitando inconsistencias como guardar con "Seleccionar..." (valor nulo).     *   **UX:** Se mejorÃƒÂ³ el comportamiento de los selectores para prevenir selecciones invÃƒÂ¡lidas accidentales.  ## [Protocolo de Seguridad] Siembra AutomÃƒÂ¡tica (Auth) **Contexto:** Debido a la volatilidad de los datos en entornos de desarrollo/nube, se ha implementado un mecanismo de 'Siembra' (seed.py).  **Funcionamiento:** 1. Al iniciar el backend (main.py), se invoca backend.core.seed.seed_all(). 2. Verifica existencia de Rol 'Administrador' (ID 1). Si falta, lo crea. 3. Verifica existencia de Usuario 'admin'. Si falta, lo crea (Pass: admin).   ### [2025-12-07] Mejoras Visuales y Fixes Interactividad (Clientes) *   **Enriquecimiento Visual (UI/UX):**     *   **Vista Lista:** Nuevas columnas para "Domicilio Fiscal" y "Contacto Principal", visibles en resoluciones medias/altas.     *   **Alerta de Entrega:** Indicador visual (Punto Naranja Ã°Å¸Å¸Â ) en filas y tarjetas cuando el cliente posee un domicilio de entrega distinto al fiscal.     *   **Card Expansible:** Efecto hover en "Vista Grid" que despliega informaciÃƒÂ³n detallada (Segmento, DirecciÃƒÂ³n, Contacto) sin sobrecargar la vista inicial. *   **Interactividad:**     *   **Doble Click:** Se habilitÃƒÂ³ globalmente. Ahora abre el Inspector tanto desde la tarjeta como desde el renglÃƒÂ³n de la lista.     *   **MenÃƒÂº Contextual:** Se asegurÃƒÂ³ que la acciÃƒÂ³n "Editar" seleccione y cargue correctamente al cliente en el inspector. *   **Estabilidad Frontend:**     *   **Fix Sintaxis:** Se corrigiÃƒÂ³ un error de compilaciÃƒÂ³n (`Attribute name cannot contain...`) causado por una llave duplicada en `HaweView.vue`.     *   **Backend:** Propiedades calculadas en el modelo `Cliente` (`domicilio_fiscal_resumen`, etc.) para optimizar el rendimiento y lÃƒÂ³gica de presentaciÃƒÂ³n.    ### [2025-12-08] Rubros V5: Acciones Masivas y CorrecciÃƒÂ³n de Sintaxis *   **GestiÃƒÂ³n Masiva (Bulk Actions):**     *   **Funcionalidad:** ImplementaciÃƒÂ³n de "Mover Seleccionados" y "PromociÃƒÂ³n (Independizar)" en RubrosView.     *   **UI:** DiÃƒÂ¡logo de selecciÃƒÂ³n de destino y Wizard (`RubroReassignWizard`) para manejo de dependencias crÃƒÂ­ticas en operaciones destructivas.     *   **Backend:** Endpoint `POST /rubros/bulk_move` operativo. *   **Estabilidad Frontend:**     *   **Fix Sintaxis CrÃƒÂ­tico:** CorrecciÃƒÂ³n de erroes de cierre de etiquetas (`</div>`, `</main>`) en `RubrosView.vue` que causaban "Failed to fetch module".     *   **Layout:** RefactorizaciÃƒÂ³n de la estructura HTML para anidar correctamente el Inspector dentro del layout principal.     *   **VisualizaciÃƒÂ³n:** Ajuste en el filtrado para que los Sub-rubros no aparezcan en la grilla principal (RaÃƒÂ­z) salvo en bÃƒÂºsquedas explÃƒÂ­citas. *   **PrÃƒÂ³ximos Pasos (DiseÃƒÂ±o):**     *   Se definiÃƒÂ³ un nuevo requerimiento de diseÃƒÂ±o "Split Screen" (Maestro-Detalle vertical) para la gestiÃƒÂ³n de sub-rubros, a implementar en la siguiente sesiÃƒÂ³n.  ### [2025-12-09] FinalizaciÃƒÂ³n Modulo Rubros V5 (Split & UX) *   **ImplementaciÃƒÂ³n "Split Screen":**     *   **DiseÃƒÂ±o:** Nuevo layout vertical 66/33. Panel superior para Rubros Principales y panel inferior para Sub-rubros.     *   **Mecanismo:** El panel inferior reacciona dinÃƒÂ¡micamente a la selecciÃƒÂ³n del padre.     *   **VisualizaciÃƒÂ³n:** Soporte dual (Grid/List) en el panel principal. *   **CorrecciÃƒÂ³n de UX (Norma DEOU):**     *   **F10:** Se implementÃƒÂ³ el atajo global para guardar en el inspector (faltante en la primera versiÃƒÂ³n).     *   **Doble Click:** Se habilitÃƒÂ³ la apertura del inspector al hacer doble click en tarjetas y renglones. *   **CorrecciÃƒÂ³n de Bugs:**     *   **Sintaxis:** Se resolviÃƒÂ³ definitivamente el error de compilaciÃƒÂ³n `Invalid end tag` reescribiendo el componente para asegurar la integridad HTML.     *   **Router:** Se verificÃƒÂ³ la ruta correcta `/hawe/rubros`.     *   **Interactividad:** Se implementÃƒÂ³ el "Slider" (Toggle Switch) de activaciÃƒÂ³n/desactivaciÃƒÂ³n en las Fichas y en la Lista de Rubros, homologando el comportamiento con el mÃƒÂ³dulo Clientes. Incluye validaciÃƒÂ³n de integridad (no permite desactivar si tiene hijos).  ### [2025-12-09] VerificaciÃƒÂ³n de MigraciÃƒÂ³n Masiva y Seguridad *   **InvestigaciÃƒÂ³n "Rubro Destino":**     *   Se reportÃƒÂ³ imposibilidad de desactivar el rubro "Rubro Destino" (TS2).     *   **Causa:** El sistema protege correctamente la desactivaciÃƒÂ³n porque el rubro posee hijos activos ("1 Sub").     *   **ResoluciÃƒÂ³n:** Comportamiento esperado (Feature, no bug). El usuario debe usar el Inspector para gestionar la baja o reasignaciÃƒÂ³n. *   **Prueba de Carga (Stress Test):**     *   Se generÃƒÂ³ un dataset de prueba ("RUBRO MASIVO TEST") con 15 sub-rubros mediante script `seed_subrubros.py`.     *   **MigraciÃƒÂ³n Exitosa:** Se ejecutÃƒÂ³ el Wizard de eliminaciÃƒÂ³n, moviendo los 15 hijos a la categorÃƒÂ­a "HUÃƒâ€°RFANOS" en una sola operaciÃƒÂ³n (`bulk_move`).     *   **Integridad:** El padre fue eliminado correctamente tras la limpieza de dependencias.  *   **Refinamiento UX (Smart Toggle):**     *   **Solicitud Usuario:** "Si intento desactivar con el slider, quiero que me deje gestionar los hijos, no solo que me bloquee".     *   **ImplementaciÃƒÂ³n:** Se modificÃƒÂ³ la lÃƒÂ³gica del Toggle Switch. Si el rubro tiene hijos, en lugar de mostrar una alerta bloqueante, se invoca automÃƒÂ¡ticamente al **Wizard de MigraciÃƒÂ³n** (mismo flujo que Eliminar).     *   **Resultado:** UX fluida que guÃƒÂ­a al usuario a la resoluciÃƒÂ³n del conflicto (reasignaciÃƒÂ³n) en lugar de un "punto muerto".  ### [2025-12-09] EstabilizaciÃƒÂ³n Productos y RefactorizaciÃƒÂ³n Rubros Flat *   **RefactorizaciÃƒÂ³n Mayor (Rubros Flat):**     *   **Cambio de Modelo:** Se eliminÃƒÂ³ la lÃƒÂ³gica jerÃƒÂ¡rquica (Padre/Hijo) en el frontend para simplificar la categorizaciÃƒÂ³n. Ahora `RubrosView` muestra una grilla plana unificada.     *   **Backend:** Se simplificÃƒÂ³ `GET /rubros` para devolver todos los registros sin filtrar por `padre_id`.     *   **UI:** Se eliminÃƒÂ³ la vista de pantalla dividida ("Split Pane"). Se migraron los controles de Ordenamiento y Vistas (Grid/List) para coincidir con `HaweView` (Clientes).     *   **OptimizaciÃƒÂ³n de Carga:** Se migrÃƒÂ³ el estado de Rubros al `useProductosStore` (Pinia) para mantener los datos en memoria y evitar el parpadeo de carga ("flash") al navegar entre pestaÃƒÂ±as.  *   **Estabilidad ProductosView:**     *   **Fix Reload Loop:** Se reescribiÃƒÂ³ `ProductosView.vue` desde cero para limpiar errores de anidamiento HTML que causaban recargas infinitas y errores 500 en Vite.     *   **Performance:** La carga inicial se optimizÃƒÂ³ al usar la lista plana de rubros cacheada.  *   **CorrecciÃƒÂ³n de Bugs (En Proceso):**     *   **Flash al Hover (Rubros):** Se detectÃƒÂ³ un problema donde, al pasar el mouse por una ficha con efecto de lupa (`scale`), el contenedor colapsaba y generaba un bucle de `mouseenter`/`mouseleave`.     *   **SoluciÃƒÂ³n Aplicada:** Se agregÃƒÂ³ `min-h-[140px]` al contenedor de la grilla en `RubrosView.vue` para reservar el espacio fÃƒÂ­sico.     *   **Estado:** El usuario reportÃƒÂ³ que el problema persistÃƒÂ­a antes de cerrar la sesiÃƒÂ³n. Pendiente de verificaciÃƒÂ³n visual profunda en prÃƒÂ³xima sesiÃƒÂ³n.  *   **Estado del Sistema:**     *   **Productos:** Operativo, carga rÃƒÂ¡pida.     *   **Rubros:** Operativo (Flat), bug visual menor pendiente de confirmaciÃƒÂ³n.     *   **Backend:** Estable, sin errores de recursiÃƒÂ³n.  ### [2025-12-09] FinalizaciÃƒÂ³n Rubros V5 (Bug Fix Hover) *   **CorrecciÃƒÂ³n Visual (Flash al Hover):**     *   **DiagnÃƒÂ³stico:** Se identificÃƒÂ³ conflicto de transformaciones CSS entre el control de la grilla (`RubrosView`) y la lÃƒÂ³gica interna de escalado (`FichaCard`). La doble aplicaciÃƒÂ³n de `transform` causaba parpadeo y bucles de evento.     *   **SoluciÃƒÂ³n:** Se eliminaron las clases redundantes `transition-transform duration-200 hover:-translate-y-1` en `RubrosView.vue`, dejando que el componente `FichaCard` maneje exclusivamente su estado visual (Doctrina de encapsulamiento). *   **VerificaciÃƒÂ³n:**     *   El mÃƒÂ³dulo Rubros ahora sigue estrictamente el estÃƒÂ¡ndar visual de `HaweView` (Clientes) y `TransportesView`.     *   **Estado:** MÃƒÂ³dulo Rubros CERRADO y ESTABLE.  ### [2025-12-09] EstabilizaciÃƒÂ³n Productos (Fix Loop Hover) *   **CorrecciÃƒÂ³n Bug CrÃƒÂ­tico (Infinite Reload Loop):**     *   **SÃƒÂ­ntoma:** "Flasheo" e inestabilidad al pasar el mouse por tarjetas de Productos.     *   **Causa:** La tarjeta emitÃƒÂ­a el evento `select` al hacer hover, lo que disparaba un `fetch` al backend, que a su vez refrescaba la lista y reiniciaba el componente, creando un ciclo infinito.     *   **SoluciÃƒÂ³n:**         *   Se deshabilitÃƒÂ³ el `emit('select')` automÃƒÂ¡tico en el evento `mouseenter` de `ProductoCard.vue`.         *   Se eliminÃƒÂ³ el posicionamiento `absolute` forzado en `ProductosView.vue` para respetar la lÃƒÂ³gica interna de expansiÃƒÂ³n de la tarjeta.     *   **Resultado:** El efecto "Lupa" (Zoom) funciona visualmente, pero la selecciÃƒÂ³n (y carga de datos) requiere un **Click** explÃƒÂ­cito, homologando el comportamiento con el mÃƒÂ³dulo Clientes.  ### [2025-12-09] Mejoras de UX (Toggle Switch) *   **Feature:** Se replicÃƒÂ³ el control de estado de Clientes en el mÃƒÂ³dulo de Productos.     *   **Visual:** Interruptor deslizante (Slider) Verde/Rojo en lugar de checkboxes.     *   **LÃƒÂ³gica:**         *   **Activar:** Inmediato.         *   **Desactivar:** Requiere confirmaciÃƒÂ³n explÃƒÂ­cita (Dialogo del navegador) para evitar accidentes operativos.     *   **Arquitectura:** Se implementÃƒÂ³ un `slot` de acciones en `ProductoCard` para inyectar botones contextuales sin ensuciar el componente base.  ### [2025-12-09] EstandarizaciÃƒÂ³n de UI (Productos) *   **Barra de Herramientas:**     *   **Filtros de Estado:** Se reemplazÃƒÂ³ el botÃƒÂ³n simple de "Inactivos" por un grupo de botones (Todos | Activos | Inactivos) consistente con el mÃƒÂ³dulo de Clientes.     *   **Ordenamiento:** Se refinÃƒÂ³ el menÃƒÂº de ordenamiento, aÃƒÂ±adiendo "Recientes" y mejorando la presentaciÃƒÂ³n.     *   **Estilos:** Se corrigiÃƒÂ³ el contraste de los desplegables (Rubros) usando fondo oscuro (`#1a050b`) y texto blanco para mejorar la legibilidad. *   **Inspector de Producto:**     *   **CorrecciÃƒÂ³n Visual:** Se aplicÃƒÂ³ el mismo estilo de alto contraste (Fondo Oscuro/Texto Blanco) a todos los selectores del formulario (Rubro, Tipo, Unidades, Proveedor, IVA) para eliminar problemas de legibilidad con fondos semitransparentes.  ### [2025-12-09] RefactorizaciÃƒÂ³n de UI (Productos) *   **Tarjeta de Producto:**     *   **ReubicaciÃƒÂ³n de Status:** Se moviÃƒÂ³ el interruptor de estado (Slider) a la esquina superior derecha, integrando la funcionalidad de "Indicador de Estado" y "Control de ActivaciÃƒÂ³n" en un solo elemento. Esto liberÃƒÂ³ la zona inferior de la tarjeta para evitar que el texto "Click para editar" fuera obstruido. *   **Layout General:**     *   **Z-Index Header:** Se elevÃƒÂ³ el Z-Index de la barra superior a `30` para asegurar que el botÃƒÂ³n "Nuevo" y los filtros permanezcan accesibles y visibles incluso si el Inspector (`z-20`) solapa el contenido en resoluciones ajustadas.     *   **Hotfix:** Se corrigiÃƒÂ³ un error de sintaxis en `handleSearch` (parÃƒÂ©ntesis faltante) introducido durante la refactorizaciÃƒÂ³n anterior.  ### [2025-12-09] CorrecciÃƒÂ³n de LÃƒÂ³gica de Toggle y API (Productos) *   **CorrecciÃƒÂ³n Frontend (ProductosView):**     *   Se solucionÃƒÂ³ un `ReferenceError` en `handleToggleActive` donde se referenciaba `id` en lugar de `producto.id` al intentar cerrar el inspector tras desactivar un producto. *   **ImplementaciÃƒÂ³n API Backend:**     *   **Endpoints Faltantes:** Se detectÃƒÂ³ que la API no exponÃƒÂ­a rutas para actualizaciÃƒÂ³n y borrado lÃƒÂ³gico de productos, causando error 405.     *   **ADD `PUT /productos/{id}`:** Se implementÃƒÂ³ el endpoint para actualizar productos y sus costos asociados.     *   **ADD `DELETE /productos/{id}`:** Se implementÃƒÂ³ el endpoint para realizar el *toggle* del estado `activo` (Borrado LÃƒÂ³gico), alineado con la expectativa del frontend.  ### [2025-12-09] Refinamiento de UI y LÃƒÂ³gica (Productos) *   **Ajustes de Interfaz:**     *   **Z-Index Inspector:** Se aumentÃƒÂ³ a `z-40` para garantizar que cubra la cabecera (`z-30`) y evitar superposiciones indeseadas.     *   **Toggle en Inspector:** Se agregÃƒÂ³ un interruptor de "Activado/Desactivado" en la cabecera del Inspector, permitiendo cambiar el estado del producto sin cerrar la ficha. *   **Mejora de Backend:**     *   **Filtros de API:** Se actualizÃƒÂ³ `GET /productos/` para aceptar parÃƒÂ¡metros `activo` (bool) y `rubro_id` (int), permitiendo que los botones "Todos/Activos/Inactivos" del frontend filtren realmente en la base de datos en lugar de depender solo del cliente.  ### [2025-12-09] Refinamiento de UI (Ronda 2) *   **CorrecciÃƒÂ³n de SuperposiciÃƒÂ³n:**     *   **Espaciado:** Se redujo el ancho de la barra de bÃƒÂºsqueda (`w-96` -> `w-64`) para liberar espacio horizontal y evitar colisiones botones/inspector.     *   **Z-Index Definitivo:** Se subiÃƒÂ³ el Inspector a `z-50` para asegurar que ningÃƒÂºn elemento (como el botÃƒÂ³n "Nuevo") pueda quedar encima de ÃƒÂ©l. *   **LÃƒÂ³gica de Refresco:**     *   **Consistencia de Listado:** Se implementÃƒÂ³ una lÃƒÂ³gica de auto-refresh (`fetchProductos`) al cambiar el estado de un producto (Activar/Desactivar) si el filtro actual ("Activos" o "Inactivos") ya no coincide con el nuevo estado del ÃƒÂ­tem, asegurando que el producto desaparezca/aparezca segÃƒÂºn corresponda instantÃƒÂ¡neamente.  ### [2025-12-09] EstandarizaciÃƒÂ³n de Estilos UI *   **Botones de Filtro (Estado):** Se unificÃƒÂ³ la paleta de colores para los filtros de estado en **Clientes, Productos y Transportes**:     *   **Todos:** Indigo/Violeta (`bg-indigo-500/20 text-indigo-300`).     *   **Activos:** Verde (`bg-green-500/20 text-green-300`).     *   **Inactivos:** Rojo (`bg-red-500/20 text-red-300`). *   **Ajuste de Contraste:** Se incrementÃƒÂ³ la opacidad de los botones a `bg-[color]-600/70` y se cambiÃƒÂ³ el texto a `text-white` para mejorar la legibilidad y el "pop" visual, manteniendo la transparencia moderna pero con mayor peso. *   **Ajuste de Contraste:** Se incrementÃƒÂ³ la opacidad de los botones a `bg-[color]-600/70` y se cambiÃƒÂ³ el texto a `text-white` para mejorar la legibilidad y el "pop" visual, manteniendo la transparencia moderna pero con mayor peso. *   **DocumentaciÃƒÂ³n:** Se actualizÃƒÂ³ `ARQUITECTURA_Y_DOCTRINA_V5.txt` con estas normas de estilo.  ### [2025-12-09] ImplementaciÃƒÂ³n de Arquitectura LogÃƒÂ­stica *   **Nueva Entidad "Estrategia LogÃƒÂ­stica" (Domicilios):**     *   **Base de Datos:** Se agregaron columnas `metodo_entrega`, `modalidad_envio` y `origen_logistico` a la tabla `domicilios`.     *   **Backend:** Se actualizaron Modelos y Schemas (`Clientes`) para soportar estos nuevos campos.     *   **Frontend (DomicilioForm):** Se reemplazÃƒÂ³ el selector simple de transporte por un **Wizard LogÃƒÂ­stico** que permite definir:         1.  **MÃƒÂ©todo:** Retiro Local / Transporte / Moto / Plataforma.         2.  **Transportista:** SelecciÃƒÂ³n de empresa (Si aplica).         3.  **Modalidad:** A Domicilio / A Sucursal.         4.  **Origen:** Despachamos Nosotros / Nos Retiran (Colecta).     *   Esto cubre los 8 escenarios logÃƒÂ­sticos planteados por el usuario.  ### [2025-12-10] DefiniciÃƒÂ³n LÃƒÂ³gica LogÃƒÂ­stica y CorrecciÃƒÂ³n API *   **Hito:** Se definiÃƒÂ³ la lÃƒÂ³gica de negocio para indicadores logÃƒÂ­sticos en Clientes (Punto Naranja). *   **LÃƒÂ³gica:**     *   **Punto Naranja (Requiere Entrega):** Se activa solo si el cliente tiene un domicilio marcado como `es_entrega=True` Y que NO sea `ORIGEN_LOGISTICO='RETIRO_EN_PLANTA'`.     *   **Retiro en Planta:** Es el escenario por defecto (ej: Comisionista Juan). No requiere acciÃƒÂ³n nuestra, por ende no lleva indicador.     *   **Excepciones:** Las desviaciones del hÃƒÂ¡bito (ej: "Hoy mandalo por Pepe") se manejan en el **Pedido**, no en la ficha del cliente. *   **Bug CORS/500 Resuelto:**     *   **SÃƒÂ­ntoma:** Error de CORS al guardar domicilios.     *   **Causa:** La ruta `PUT /clientes/{id}/domicilios/{id}` declaraba `response_model=DomicilioResponse` pero el servicio devolvÃƒÂ­a un objeto `Cliente` (para actualizar la UI). Esto generaba un error de validaciÃƒÂ³n Pydantic (500) invisible.     *   **SoluciÃƒÂ³n:** Se actualizÃƒÂ³ `response_model` a `ClienteResponse` en `backend/clientes/router.py`. *   **UX Domicilio:**     *   Se simplificÃƒÂ³ `DomicilioForm.vue` moviendo flags Fiscal/Estado al encabezado y eliminando redundancias en el pie. *   **Refactor UI Segmentos:**     *   Se actualizÃƒÂ³ `SegmentoList` (modal apilado en Clientes) para eliminar el fondo blanco y usar el tema Dark Blue (`#0a1f2e`).     *   **Arquitectura:** Se migrÃƒÂ³ de Modal simple a **Inspector Lateral**, unificando la UX con el mÃƒÂ³dulo de Clientes y Productos.     *   **Router:** Se moviÃƒÂ³ la ruta `/segmentos` bajo el layout `HaweLayout` para evitar la duplicaciÃƒÂ³n de Sidebar.     *   **Sidebar UX:** Se implementÃƒÂ³ resaltado visual del "Grupo Padre" (Ej: Clientes) cuando un mÃƒÂ³dulo hijo (Ej: Segmentos) estÃƒÂ¡ activo, para mejor orientaciÃƒÂ³n del usuario.     *   Se corrigiÃƒÂ³ error de sintaxis en el componente `SegmentoList.vue`.     *   **Layout LogÃƒÂ­stica:** Se adoptÃƒÂ³ el patrÃƒÂ³n "Split-Pane" (Panel Dividido) para Segmentos, replicando la estructura de **Transportes** (Lista Izquierda + Inspector Fijo Derecha) para garantizar visibilidad y consistencia.     *   **DocumentaciÃƒÂ³n:** Se actualizÃƒÂ³ `MANUAL_OPERATIVO_V5.md` con la nueva secciÃƒÂ³n de AdministraciÃƒÂ³n de Segmentos.  > [!NOTE] > **Estado Final de SesiÃƒÂ³n:** MÃƒÂ³dulo de Segmentos operativo y consistente con la estÃƒÂ©tica V5 (Dark/Cyan). Sidebar unificado y navegaciÃƒÂ³n clara.  ### [2025-12-10] Inicio Fase Piloto y MinerÃƒÂ­a de Datos *   **Hito EstratÃƒÂ©gico:** Se definiÃƒÂ³ la estrategia de **ImplementaciÃƒÂ³n Paralela (Piloto)**.     *   **Arquitectura:** CreaciÃƒÂ³n de entorno portable BUILD_PILOTO (separado de Dev) para despliegue en producciÃƒÂ³n local sin riesgo para el cÃƒÂ³digo fuente.     *   **Objetivo:** Validar funcionalidad V5 con datos reales y sustituir progresivamente el Excel de pedidos. *   **IngenierÃƒÂ­a de Datos (Harvesting):**     *   Se desarrollÃƒÂ³ y ejecutÃƒÂ³ script harvest_excel.py para minar la historia transaccional (pedidos_raw.xlsx).     *   **Resultado:** ExtracciÃƒÂ³n exitosa de ~200 Clientes y ~300 Productos crudos (Formatos heterogÃƒÂ©neos detectados).     *   **Archivos Generados:** BUILD_PILOTO/data/clientes_raw.csv y productos_raw.csv. *   **PlanificaciÃƒÂ³n (Roadmap V5.3):**     *   Se diseÃƒÂ±ÃƒÂ³ el concepto de **Cargador TÃƒÂ¡ctico**: Una vista simplificada en V5 que permite cargar pedidos, guardar en BD limpia y exportar a Excel (Formato cliente) simultÃƒÂ¡neamente.     *   Se generaron documentos rectores: PLAN_TECNICO_GY.md y INFORME_ESTRATEGICO_USUARIO.md.  > [!IMPORTANT] > **PrÃƒÂ³xima SesiÃƒÂ³n:** Foco total en **Limpieza de Datos** (Herramientas UI de FusiÃƒÂ³n) e implementaciÃƒÂ³n del **Cargador TÃƒÂ¡ctico**.  ### [2025-12-11] ImplementaciÃƒÂ³n Data Intelligence (Piloto) y EstabilizaciÃƒÂ³n UI *   **Data Cleaner UI (Herramienta CrÃƒÂ­tica):**     *   **Desarrollo:** Se creÃƒÂ³ la interfaz visual `DataCleaner.vue` para la curaciÃƒÂ³n masiva de datos candidatos (clientes y productos extraÃƒÂ­dos del Excel legado).     *   **Funcionalidades:**         *   **EdiciÃƒÂ³n en LÃƒÂ­nea:** CorrecciÃƒÂ³n de nombres mal escritos (Ej: "JabÃƒÂ³n Liq" -> "JabÃƒÂ³n LÃƒÂ­quido").         *   **ValidaciÃƒÂ³n de CUIT:** VerificaciÃƒÂ³n en tiempo real con algoritmo Modulo 11 y formateo automÃƒÂ¡tico.         *   **Sort & Group:** Ordenamiento inteligente por "Frecuencia" (para identificar productos top) y "Nombre Original" (para agrupar variantes).         *   **Estabilidad UI:** Se resolviÃƒÂ³ un bug de "Cursor Saltador" usando claves estables (`_id`) y ordenamiento inmutable (`nombre_original`) durante la ediciÃƒÂ³n. *   **Commit System (Backend):**     *   **Endpoint:** ImplementaciÃƒÂ³n de `POST /data_intel/commit/{type}`.     *   **LÃƒÂ³gica de Negocio:**         *   Toma registros marcados como "IMPORTAR".         *   Verifica duplicados en la base de datos de producciÃƒÂ³n (SQLite).         *   Si es producto, asegura/crea rubro "GENERAL" por defecto.         *   Inserta los registros limpios en las tablas `clientes` o `productos`.     *   **SanitizaciÃƒÂ³n:** ImplementaciÃƒÂ³n de forzado de tipos (String) en el frontend para evitar errores de validaciÃƒÂ³n Pydantic (422) con alias numÃƒÂ©ricos. *   **Hito Piloto:**     *   Se validÃƒÂ³ el ciclo completo: ExtracciÃƒÂ³n (Excel) -> Limpieza (UI) -> Persistencia (SQLite).     *   El sistema "Piloto" (`BUILD_PILOTO`) quedÃƒÂ³ en estado operativo estable para iniciar la carga de datos reales.   > [!CAUTION] > **PrÃƒÂ³ximo Paso CrÃƒÂ­tico:** AuditorÃƒÂ­a forense de la base de datos SQL Server en la nube (IOWA) para evaluar migrabilidad.  ### [2025-12-11] Estrategia de Respaldo "Golden Seeds" *   **DefiniciÃƒÂ³n:** Se estableciÃƒÂ³ como polÃƒÂ­tica de seguridad la generaciÃƒÂ³n periÃƒÂ³dica de archivos CSV planos (`SEMILLAS_MAESTRAS`) que contengan el estado completo de las tablas crÃƒÂ­ticas (Clientes, Productos, Transportes, etc.). *   **PropÃƒÂ³sito:** Servir como "Arca de NoÃƒÂ©" ante catÃƒÂ¡strofes tecnolÃƒÂ³gicas. Si se pierde la DB (Local y Nube), el sistema puede reconstruirse desde estos archivos. *   **Requerimiento Futuro (V5):** Implementar una utilidad de usuario "Backup de Emergencia" que invite al operador a descargar estos CSV a un soporte externo (Drive, Pendrive) regularmene.  ### [2025-12-11] DiseÃƒÂ±o: Cargador TÃƒÂ¡ctico "Excel Killer" *   **DefiniciÃƒÂ³n:** Se aprobÃƒÂ³ el diseÃƒÂ±o tÃƒÂ©cnico (`DISEÃƒâ€˜O_CARGADOR_TACTICO.md`) para el mÃƒÂ³dulo de carga de pedidos de alta velocidad. *   **CaracterÃƒÂ­sticas:** UI tipo Grilla, navegaciÃƒÂ³n 100% teclado, buscador semÃƒÂ¡ntico (F3), Feedback en tiempo real. *   **Estado:** Listo para desarrollo. Fase 1 (Esqueleto UI) pendiente para la prÃƒÂ³xima sesiÃƒÂ³n.  ## [2025-12-11] ConsolidaciÃƒÂ³n Data Cleaner y SincronizaciÃƒÂ³n Piloto  ### Resumen ImplementaciÃƒÂ³n final del flujo de "Data Cleaner" para la importaciÃƒÂ³n y validaciÃƒÂ³n de datos maestros. Se resolviÃƒÂ³ la persistencia de duplicados, se mejorÃƒÂ³ la UX para la correcciÃƒÂ³n de errores (CUITs truncados) y se estableciÃƒÂ³ la sincronizaciÃƒÂ³n unidireccional hacia la nube.  ### Implementaciones Clave 1.  **ValidaciÃƒÂ³n Inteligente de Duplicados (Smart Update):**     *   **LÃƒÂ³gica:** Si el CUIT/Nombre existe Identico -> `EXISTENTE` (Skip). Si difiere -> `ACTUALIZADO` (Update).     *   **Persistencia:** CorrecciÃƒÂ³n crÃƒÂ­tica en `router.py` para asegurar que el estado (`EXISTENTE`) se guarde en el CSV fÃƒÂ­sico (`df.to_csv`), evitando bucles infinitos de procesamiento. 2.  **UX "Dirty State":** DetecciÃƒÂ³n automÃƒÂ¡tica de cambios en el frontend. Si el usuario edita un campo de un registro grisado, este se reactiva (`IMPORTAR`) automÃƒÂ¡ticamente. 3.  **CorrecciÃƒÂ³n de CUITs:** AmpliaciÃƒÂ³n del input de CUIT a 15 caracteres para permitir guiones, aunque se guarden solo los dÃƒÂ­gitos. 4.  **Workflow sin Bloqueos:** HabilitaciÃƒÂ³n permanente del botÃƒÂ³n `IMPORTAR (F10)` eliminando la obligatoriedad de "Guardar" previo (el sistema auto-guarda). 5.  **Cierre de Ciclo (Cloud Sync):** CreaciÃƒÂ³n y ejecuciÃƒÂ³n de `scripts/push_pilot_to_cloud.py` para subir los datos validados (`_master.csv`) al entorno remoto (Postgres IOWA).  ### DecisiÃƒÂ³n de Arquitectura: "Master CSV Strategy" Se formalizÃƒÂ³ en `PROTOCOLO_DATOS.md` que la fuente de verdad son los archivos `clientes_master.csv` y `productos_master.csv`, siendo la DB SQLite un derivado operacional y la Nube un espejo de respaldo.  ### Estado Final *   **Data Cleaner:** Operativo y estabilizado. *   **GestiÃƒÂ³n de Duplicados:** Resuelto. *   **Nube:** Sincronizada con 11 clientes validados.  ### Ã¢Å¡Â  AVISO DE NAVEGACIÃƒâ€œN (PrÃƒÂ³xima SesiÃƒÂ³n) **DOCUMENTO DE LECTURA OBLIGATORIA:** `PROTOCOLO_DATOS.md` Antes de cualquier operaciÃƒÂ³n de carga o mantenimiento de datos, leer el protocolo definido en esta sesiÃƒÂ³n. ### [2025-12-12] Pivot EstratÃƒÂ©gico: OperaciÃƒÂ³n Nike (Doctrina de Sanidad) *   **Contexto:** Se detectÃƒÂ³ que el enfoque de "ImportaciÃƒÂ³n Perfecta" (limpiar todo antes de cargar) era inviable y generaba fricciÃƒÂ³n operativa. *   **Nueva Doctrina (Nike Report):**     1.  **DepuraciÃƒÂ³n Just-in-Time:** Se acepta la carga "sucia". La limpieza ocurre en la trinchera, al momento de cargar un pedido.     2.  **Fuente de Verdad:** La Base de Datos V5 es la autoridad suprema.     3.  **Golden Seeds (Blindaje):** Respaldo automÃƒÂ¡tico de tablas maestras a CSV planos tras cada sesiÃƒÂ³n. "Punto de RestauraciÃƒÂ³n Institucional". *   **Dispositivo TÃƒÂ¡ctico (Grid V5):**     *   Interfaz de carga de alta velocidad ("Excel Killer").     *   **SemÃƒÂ¡foro de AuditorÃƒÂ­a (F3):**         *   Ã°Å¸Å¸Â¢ **VERDE:** Listo para facturar.         *   Ã°Å¸â€�Â´ **ROJO:** Requiere intervenciÃƒÂ³n (Inspector).         *   Ã°Å¸â€”â€˜Ã¯Â¸ï¿½ **KILL:** Basura / Duplicado -> Soft Delete. *   **PrÃƒÂ³ximos Pasos:** Desarrollo del `TacticalView` y componente de SemÃƒÂ¡foro.  > [!IMPORTANT] > **Base de Datos:** Se confirma que la operaciÃƒÂ³n inicia sobre la base SQLite local (`pilot.db`), respaldada por los CSVs maestros.   ### [2025-12-14] Refinamiento TÃƒÂ¡ctico y Arquitectura Unificada (Refactor 5 Puntos) *   **Hito ArquitectÃƒÂ³nico (Respuesta a Inquietud de DesvÃƒÂ­o):**     *   **ConfirmaciÃƒÂ³n de Unidad:** Se valida que el "Cargador TÃƒÂ¡ctico" (`GridLoader.vue`) y el sistema V5 (`HaweView.vue`) comparten el **100% de los componentes maestros**.     *   **Evidencia:** El arreglo del `ClienteInspector` (usado para corregir CUITs) se aplicÃƒÂ³ una sola vez y corrigiÃƒÂ³ instantÃƒÂ¡neamente ambos mÃƒÂ³dulos. No existen "ramas ocultas" ni cÃƒÂ³digo duplicado divergente. *   **ImplementaciÃƒÂ³n de Mejoras (User Feedback):**     *   1. **Segmentos ABM:** ConexiÃƒÂ³n de `SimpleAbmModal` en el entorno tÃƒÂ¡ctico.     *   2. **Fix CUIT Header:** Reactividad corregida en el inspector unificado.     *   3. **Toasts (Feedback):** Notificaciones visuales de ÃƒÂ©xito al guardar.     *   4. **Autosave TÃƒÂ¡ctico:** ImplementaciÃƒÂ³n de persistencia local (`localStorage`) para evitar pÃƒÂ©rdida de pedidos borrador.     *   5. **Persistencia de Orden:** Memoria de preferencia de ordenamiento en listados. *   **Incidente y CorrecciÃƒÂ³n RÃƒÂ¡pida:**     *   **Crash:** Pantalla blanca por `ReferenceError: watch`.     *   **SoluciÃƒÂ³n:** ImportaciÃƒÂ³n faltante agregada en `GridLoader.vue` y `HaweView.vue`.     *   **Crash:** `Invalid prop: clienteId` en `ClientCanvas`.     *   **SoluciÃƒÂ³n:** ProtecciÃƒÂ³n `v-if="form.id"` agregada a `ContactoForm` para evitar renderizado prematuro.     *   **UX:** Teclas `F3` y `F4` saltaban a Cliente globalmente.     *   **SoluciÃƒÂ³n:** Se eliminÃƒÂ³ la captura global en `GridLoader` para respetar el contexto local (ej. bÃƒÂºsqueda de productos).     *   **Bug:** Segmento ABM no guardaba (Error de ID).     *   **SoluciÃƒÂ³n:** Se corrigiÃƒÂ³ `SegmentoInspector` para no enviar ID vacÃƒÂ­o (autogenerado por backend) y se limpiÃƒÂ³ el payload en `SegmentoList`.     *   **UX:** Alerta "CUIT Compartido" molesta en Consumidor Final (`00000000000`).     *   **SoluciÃƒÂ³n:** Se aÃƒÂ±adiÃƒÂ³ una excepciÃƒÂ³n en el backend (`ClienteService.check_cuit`) para ignorar la verificaciÃƒÂ³n de duplicados si el CUIT es genÃƒÂ©rico (todos ceros), permitiendo mÃƒÂºltiples "Consumidores Finales" sin alertas.    ### 2025-12-15 13:10 - Protocolo de SincronizaciÃ³n de Datos (Anti-Desliz) > [!IMPORTANT] > **LECCIÃ“N APRENDIDA:** El cÃ³digo viaja por Git, pero los **DATOS** (SQLite) viajan por **Semillas (CSV)**. > > **Problema:** Se trabajÃ³ en una ubicaciÃ³n (CA), se agregaron clientes/productos, pero no se exportaron las semillas. Al llegar a la otra ubicaciÃ³n (OF), el cÃ³digo estaba actualizado pero la base de datos vacÃ­a o desactualizada. > **Intento Fallido:** Se intentÃ³ conectar a la Nube (IOWA) como backup, pero fallÃ³ por timeout (Firewall/IP).  **PROTOCOLO OBLIGATORIO AL TERMINAR SESIÃ“N (HANDOVER):** 1.  **Ejecutar:** python scripts/export_master_seeds.py (Exporta DB -> CSV en SEMILLAS_MAESTRAS/). 2.  **Verificar:** Que los archivos .csv tengan fecha/hora actual. 3.  **Git:** git add SEMILLAS_MAESTRAS/ -> commit -> push.  **PROTOCOLO AL INICIAR SESIÃ“N:** 1.  **Git:** git pull. 2.  **Verificar:** Si hay nuevos CSVs en SEMILLAS_MAESTRAS/. 3.  **Ejecutar:** python scripts/restore_seeds.py (Importa CSV -> DB Local).  ## [2025-12-15] RefactorizaciÃƒÂ³n de Flujo de Pedidos - **DB**: Added 	ipo_comprobante column (scripts/add_tipo_to_pedidos.py). - **API**: Updated Pedido Create/Update schemas and router logic. - **UX**: Implemented Gmail-style drafts (Auto-save, no prompts). - **UX**: Unified status control via Dropdown (Pendiente triggers Fiscal/X prompt). - **Fix**: Resolved CORS/500 crash due to migration script path issue. - **Fix**: Repaired invalid Vue template in PedidoInspector.  ## [2025-12-16] ImplementaciÃƒÂ³n Motor de Precios V5  ### Contexto El usuario requerÃƒÂ­a formalizar la lÃƒÂ³gica de "precios sugeridos" que hasta ahora era mental. Se definiÃƒÂ³ la doctrina "La Roca y La MÃƒÂ¡scara" para manejar la dualidad entre Costo Real y Precio de Lista (Vidriera).  ### Cambios TÃƒÂ©cnicos 1.  **Base de Datos:**     *   `productos_costos`: Agregado `precio_fijo_override` (Numeric), `permitir_descuentos` (Bool).     *   `clientes`: Agregado `estrategia_precio` (String/Enum).     *   Script de migraciÃƒÂ³n: `scripts/update_db_pricing_engine.py`.  2.  **Backend:**     *   Nueva clase `backend.pedidos.pricing.PricingEngine`.     *   Nuevo endpoint `POST /pedidos/cotizar`.     *   LÃƒÂ³gica de escenarios (K-Factors): `MAYORISTA_FISCAL`, `MAYORISTA_X`, `MELI_CLASICO`.  3.  **Frontend (`GridLoader`):**     *   IntegraciÃƒÂ³n con endpoint de cotizaciÃƒÂ³n.     *   Componente `MagicInput.vue`: Input que evalÃƒÂºa expresiones matemÃƒÂ¡ticas (`eval` sanitizado local).  ### VerificaciÃƒÂ³n Script `scripts/war_game_pricing_v5_fix.py` ejecutado con ÃƒÂ©xito. - Validado cÃƒÂ¡lculo reverso de descuentos. - Validado markup de MELI. - Validado override de precios fijos.  ## Pendientes para esta sesiÃƒÂ³n (Rescatado de OF)  ### Hallazgos y Pendientes 1.  **Campo OC (Orden de Compra):** Existe en BD (pedidos.oc) pero falta en:     *   Schema PedidoResponse (Backend).     *   UI PedidoTacticoView (Input explÃƒÂ­cito).     *   UI PedidoInspector (EdiciÃƒÂ³n). 2.  **UX TÃƒÂ¡ctico:** Falta botÃƒÂ³n 'Limpiar/Nuevo' explÃƒÂ­cito para resetear el borrador sin recargar. 3.  **Plan de AcciÃƒÂ³n:** Se generÃƒÂ³ el implementation_plan.md para abordar estos puntos en la prÃƒÂ³xima sesiÃƒÂ³n.  ### Nota Post-Cierre Se intentÃƒÂ³ correr una 'SimulaciÃƒÂ³n de Integridad' (Frontend Build + Backend Tests), pero se abortÃƒÂ³ por falta de tiempo. Queda pendiente verificar el estado del servidor y tests de integraciÃƒÂ³n en la prÃƒÂ³xima sesiÃƒÂ³n.  --- ## [SESIÃ“N 17-DIC-2025] - Limpieza Profunda y Acceso LAN  ### Objetivo Habilitar herramientas para la 'depuraciÃ³n masiva' de la base de datos (clientes/productos basura) y configurar el entorno para permitir la carga de datos concurrente desde mÃºltiples puestos (LAN).  ### Logros 1.  **Limpieza Masiva (Bulk Hard Delete):**     *   Implementado mecanismo de 'Doble Fase':         *   **Fase 1 (Naranja):** DesactivaciÃ³n masiva (Soft Delete) desde el filtro 'Activos'.         *   **Fase 2 (Rojo):** EliminaciÃ³n definitiva (Hard Delete) desde el filtro 'Inactivos'.     *   Aplicado tanto en **Clientes** como en **Productos**.     *   **Seguridad:** Backend protege registros con integridad referencial (no deja borrar si tienen ventas).  2.  **SanitizaciÃ³n de CUITs:**     *   **Frontend:** El inspector limpia automÃ¡ticamente guiones y espacios al guardar.     *   **Backend:** Validator Pydantic ('clean_cuit') fuerza string numÃ©rico de 11 dÃ­gitos.     *   Resultado: Se permite input flexible ('20-1234...') pero se guarda limpio ('201234...').  3.  **Acceso Remoto (LAN / Multijugador):**     *   **ConfiguraciÃ³n Backend:** CORS habilitado para '*' (Wildcard).     *   **ConfiguraciÃ³n Firewall:** Scripts para abrir puertos 8000 (API) y 5173 (Web).     *   **Hardcoding de IP:** Se fijÃ³ la IP '192.168.0.34' en 'api.js' y 'Login.vue' para anular problemas de resoluciÃ³n de nombres o variables de entorno.     *   **Launcher:** Se creÃ³ 'scripts/run_lan.ps1' para automatizar el arranque en modo red.     *   **Usuarios:** Se creÃ³ el usuario 'operador' (carga restringida) y se reseteÃ³ 'admin'.  ### Estado Final El sistema estÃ¡ desplegado en la red local y listo para que el equipo comience la carga y depuraciÃ³n de datos.

## SESIÃ“N 2025-12-17: DepuraciÃ³n de Persistencia y AlineaciÃ³n UX (Baja de Productos)

### Objetivos Alcanzados
1.  **Persistencia de Baja LÃ³gica (Soft Delete)**: Se diagnosticÃ³ y corrigiÃ³ un fallo crÃ­tico donde los productos "desactivados" reaparecÃ­an como activos tras el refresco.
    *   **Causa RaÃ­z 1 (Backend)**: El endpoint `GET /productos/` devolvÃ­a un objeto debug incompleto sin el campo `activo`. Se restaurÃ³ el `response_model=List[schemas.ProductoRead]` para garantizar integridad de datos.
    *   **Causa RaÃ­z 2 (Infra)**: ConfiguraciÃ³n CORS incorrecta (ComodÃ­n `*` + Credenciales) bloqueaba peticiones PUT/POST en navegadores modernos. Se restringiÃ³ a orÃ­genes explÃ­citos.
    *   **Causa RaÃ­z 3 (SQLite)**: Fallos de concurrencia (`ConnectionReset`) al escribir en DB desde hilos paralelos. Se aplicÃ³ `check_same_thread=False` en `database.py`.
2.  **AlineaciÃ³n UX/UI**: Se rediseÃ±Ã³ el inspector de productos para coincidir con el mÃ³dulo de Clientes.
    *   Reemplazo de botÃ³n "toggle" genÃ©rico por botones explÃ­citos: **"Dar de Baja"** (Rojo) y **"Activar"** (Verde).
    *   LÃ³gica de refresco automÃ¡tico robusta en `ProductosView.vue` para reflejar cambios inmediatamente.
3.  **Limpieza de Datos**: Se verificÃ³ la capacidad operativa del "Limpiador de Productos" (Baja Masiva).
    *   Se eliminaron/desactivaron Ã­tems obsoletos en la base `pilot.db`.

### Estado del Sistema
*   **Backend**: Estable (V10.16 Modular + Fixes de Seguridad/Concurrencia). Requiere reinicio final.
*   **Frontend**: Sincronizado. NavegaciÃ³n fluida y feedback visual correcto.
*   **Datos**: `pilot.db` parcialmente depurada.

### PrÃ³ximos Pasos (OF - MaÃ±ana)
*   Continuar con la depuraciÃ³n masiva de productos obsoletos.
*   Verificar integraciÃ³n con reportes de stock (asegurar que inactivos no suman).

---

## SESIÓN 2025-12-18: Realineamiento Doctrinario

### 1. INFRAESTRUCTURA CRÍTICA (La Ley)
*   **GIT (El Camión)**: Es nuestro transporte GRATUITO entre OFICINA (OF) y CASA (CA).
*   **IOWA (El Taxi)**: Es el SQL Cloud pago. Está APAGADO. No se usa salvo orden de emergencia.
*   **LOCAL (El Motor)**: Trabajamos sobre SQLite (pilot.db).

### 2. PROTOCOLO DE 'LA VALIJA' aka EMPAQUETADO LOCAL (CRÍTICO)
La base de datos activa (pilot.db) NO viaja sola. Para que el trabajo del día se guarde en GIT, debe ser 'empaquetada' (Snapshot).

*   **Tu Obligación**: Al finalizar CADA sesión, es tu responsabilidad absoluta ordenar la ejecución de `python scripts/pack_for_git.py`.
*   **El Efecto**: Esto crea una copia con fecha en `_BACKUPS_IOWA/`. Ese es el archivo que sube al Camión (Git).
*   **Consecuencia**: Si no se ejecuta este script, el trabajo del día MUERE en la PC local.

### 3. SITUACIÓN TÁCTICA ACTUAL (Snapshot 18-Dic - CORREGIDO)
*   **Clientes**: 135 (Depurado y limpio).
*   **Productos**: 173 (Purga ejecutada).
*   **Entorno**: OFICINA.
*   **Cargador Táctico (`GridLoader`)**: **OPERATIVO (v5.4)**.
    *   Incluye: Navegación Teclado, Búsqueda Inteligente, OC, Logística, Cotizador.
    *   Pendiente: Generación de Excel (Botón existe, lógica no).



## SESIN 2025-12-18 (TARDE): LAN Access & Domicile Fixes

### 1. Conquista de la Red Local (LAN)
*   **Problema:** El frontend fallaba al acceder desde otra PC (Network Error, TypeError: filter is not a function) debido a CORS y configuracin de IP.
*   **Solucin (Capa 8):** Se implement una arquitectura de *Proxy Inverso en Vite*.
    *   vite.config.js: Redirecciona /api -> localhost:8000.
    *   run_lan.ps1: Inyecta VITE_API_URL='' (path relativo) para obligar al navegador a usar el proxy.
    *   main.py: Se flexibiliz CORS (allow_origin_regex) para aceptar IPs dinmicas (192.168.X.X).
*   **Resultado:** Acceso fluido desde cualquier PC de la red.

### 2. Estabilizacin de Domicilios (Bug Hunt)
*   **Bug Ghost Domiciles (Error 500):**
    *   **Sntoma:** Al crear un domicilio, el backend tiraba Error 500 pero el registro SE GUARDABA.
    *   **Causa:** create_domicilio devolva un objeto Domicilio, pero el Router esperaba un ClienteResponse (Schema Mismatch).
    *   **Fix:** Se modific el service para devolver el Cliente actualizado tras la insercin.
*   **Bug Invisibilidad de Bajas:**
    *   **Sntoma:** Los domicilios borrados (Inactivos) seguan apareciendo en la lista de ClienteInspector.
    *   **Fix:** Se aplic un filtro explcito .filter(d => d.activo !== false) en el frontend (ClienteInspector.vue).

### 3. Preparacin Motor de Precios (La Roca)
*   **Estado:** Base de datos con costos en 0.
*   **Estrategia:** Se dise el *Importador Masivo de Costos*.
*   **Plan (Para Turno Noche - Entorno CA):**
    *   Implementar Endpoint POST /productos/import/costos.
    *   Implementar Modal de Carga en Frontend.
    *   Documento Rector: implementation_plan.md (Ya creado en Brain).

## [2025-12-19] FASE 1 & 2: SEGURIDAD Y ESTANDARIZACIN (AGENT: ANTIGRAVITY)
- **Backup**: Realizado respaldo de pilot.db en _BACKUPS_IOWA.
- **Pythonization (Scripts Universales)**:
    - Creados scripts/run_dev.py y scripts/backup.py.
    - Se elimin dependencia de .ps1 para ejecucin de backend.
    - Corregido error de importacin de mdulo 'backend' mediante ajuste de PYTHONPATH en un_dev.py.
    - Corregido error de parseo de SQLite en ackend/core/database.py.
- **Limpieza**: equirements.txt validado.
- **Protocolo**: Oficialmente se utiliza python scripts/run_dev.py para el arranque.

 # #   S E S I  N   2 0 2 5 - 1 2 - 1 9 :   R e p a r a c i  n   E s t r u c t u r a l   y   A B M   M a e s t r o s   ( A G E N T :   A N T I G R A V I T Y ) 
 
 # # #   O b j e t i v o s   A l c a n z a d o s 
 1 .     * * B a j a   F  s i c a   d e   C l i e n t e s   ( C o r r e g i d o   y   R o b u s t o ) * * : 
         -       S e   i m p l e m e n t    e l   f l u j o   c o m p l e t o   d e s d e   U I   h a s t a   D B . 
         -       * * R e p a r a c i  n   d e   E r r o r   4 0 4 * * :   S e   i m p l e m e n t    e l   t i p o   \ G U I D \   u n i f i c a d o   p a r a   m a n e j a r   U U I D s   s i n   g u i o n e s   e n   S Q L i t e . 
         -       * * R e p a r a c i  n   d e   E r r o r   5 0 0 * * :   S e   d e t e c t    y   c o r r i g i    u n   d e s a j u s t e   d e   e s q u e m a   ( * S c h e m a   M i s m a t c h * )   e n   \ p i l o t . d b \   ( f a l t a b a n   c o l u m n a s   e n   \ p e d i d o s \ ) . 
         -       * * I n t e g r i d a d   R e f e r e n c i a l * * :   S e   h a b i l i t    \ c a s c a d e   d e l e t e \   p a r a   l o s   c o n t a c t o s   d e l   c l i e n t e   ( V i n c u l o s C o m e r c i a l e s ) . 
 2 .     * * A B M   d e   S e g m e n t o s   ( D e s b l o q u e a d o ) * * : 
         -       S e   e l i m i n    e l   l  m i t e   a r t i f i c i a l   d e   8   s e g m e n t o s . 
         -       S e   i m p l e m e n t    l a   f u n c i o n a l i d a d   d e   e l i m i n a c i  n   d e f i n i t i v a   p a r a   s e g m e n t o s . 
         -       A c t u a l i z a d a   l a   U I   ( \ S e g m e n t o I n s p e c t o r \ )   y   e l   B a c k e n d   ( \ M a e s t r o s S e r v i c e \ ) . 
 
 # # #   D e s a f  o s   T  c n i c o s   S u p e r a d o s 
 -       * * S c h e m a   M i s m a t c h * * :   L a s   a d i c i o n e s   d e   c a m p o s   t  c t i c o s   a l   m o d e l o   \ P e d i d o \   n o   e s t a b a n   r e p l i c a d a s   e n   l a   b a s e   l o c a l .   S e   r e a l i z    m i g r a c i  n   m a n u a l   v i a   s c r i p t . 
 -       * * C o m p u t e d   P r o p e r t y   L o c k * * :   S e   c o r r i g i    u n   e r r o r   e n   e l   f r o n t e n d   ( \ H a w e V i e w . v u e \ )   d o n d e   s e   i n t e n t a b a   m u t a r   u n a   p r o p i e d a d   c o m p u t a d a ,   l o   q u e   i m p e d  a   e l   c i e r r e   d e l   i n s p e c t o r   t r a s   e l   b o r r a d o . 
 
 # # #   S i t u a c i  n   T  c t i c a   F i n a l 
 -       * * C l i e n t e s * * :   O p e r a t i v o s   c o n   B a j a   F  s i c a   c o n d i c i o n a l   ( p r e s e r v a   i n t e g r i d a d   d e   p e d i d o s ) . 
 -       * * S e g m e n t o s * * :   9   r e g i s t r o s   c o n f i r m a d o s   e n   D B .   A B M   t o t a l   h a b i l i t a d o . 
 -       * * B a s e   d e   D a t o s * * :   \ p i l o t . d b \   m i g r a d a   y   s i n c r o n i z a d a   c o n   e l   m o d e l o   V 5 . 
  
 
## SESIÓN 2025-12-19: Estelarización de Infraestructura y Módulo Pedidos (AGENT: ANTIGRAVITY)

### 🚀 Despliegue de Infraestructura LAN
- **Protocolo run_lan.py**: Se ha consolidado el script de arranque para red local. Detecta automáticamente la IP de la máquina servidor y configura tanto el Frontend como el Backend para ser accesibles desde otros dispositivos (ej: Tomás en su puesto).
- **Lanzador de Escritorio**: Se ha generado el archivo 'LAN_SERVER_V5.bat' en el Escritorio del servidor. Este permite iniciar todo el ecosistema (DB, API y Web) con un solo clic sin abrir terminales manuales.

### 📦 Módulo Pedidos (Nacimiento de la V5 Táctica)
- **Visualización de Lista**: Se diseñó la maqueta 'pedidos_mockup.html' siguiendo la estética 'Hawe'. 
- **Cargador Táctico (Speed-Grid)**: Se creó 'pedido_tactico_mockup.html', introduciendo la carga ultrarrápida sin mouse y la previsualización de precios.
- **Evolución del Esquema**: Se migraron los campos críticos a la tabla 'pedidos': 'tipo_facturacion', 'origen', 'fecha_compromiso' y 'liberado_despacho'.

### 🧬 Doctrina V5: Notas para el Futuro
- **Lógica 'La Roca y La Máscara'**: El sistema debe priorizar el precio histórico pactado con el cliente (La Máscara) sobre el precio de lista técnico (La Roca).
- **Identidad 'Rosa Chicle Fluo'**: Las entregas compromiso a futuro deben resaltarse en este tono para no perderse en el flujo de despacho diario.
- **X/Facturable**: Se estableció el selector explícito para diferenciar ventas internas de fiscales desde el inicio de la carga.

### 🛠️ Reparaciones de Emergencia (Crítico)
- **Schema Mismatch Fix**: Se resolvió el Error 500 inyectando las columnas faltantes en 'pilot.db'.
- **GUID Unified**: Implementación del nuevo tipo de ID para evitar desajustes de guiones en SQLite.
- **Cascade Delete**: Limpieza automática de contactos al borrar clientes.


---

## SESIÓN 2025-12-29: Integración de Módulo de Gestión de PDFs ARCA

### Objetivos
- Implementar una herramienta para añadir OC/PO a facturas ARCA no editables.
- Integrar un motor de procesamiento de PDFs en el Core del Backend para futuras automatizaciones.
- Crear una utilidad 'Standalone' para uso inmediato del equipo sin depender de la carga del sistema completo.

### Logros e Implementación
- **Engine de PDF (ackend/core/utils/pdf.py)**: Implementación robusta usando pikepdf, pypdf y eportlab. Resuelve el problema de las restricciones de edición de AFIP.
- **Etiquetador Express (scripts/etiquetador_escritorio.py)**: Interfaz gráfica para etiquetado rápido. Soporta búsqueda de archivos, prefijos dinámicos (OC/PO) y renombrado automático con sufijo _etq.
- **Lanzador de Escritorio**: Archivo ETIQUETADOR_PDF.bat para ejecución directa.
- **Layout ARCA Finalizado**: Posicionamiento en cuadrante superior derecho (X:570, Y:808), alineación derecha, aplicado solo a la primera página.

### 🧬 Doctrina V5: Avances
- **Modularidad de Salida**: El sistema ya no solo gestiona datos, sino que empieza a intervenir en los documentos finales de salida (Legacy Bridge).
- **Rastreo Invariante**: Se adoptó la política de mantener el nombre original del archivo de ARCA (_etq) para asegurar la trazabilidad contable.

---


> [!IMPORTANT]
> **AISLAMIENTO DE SEGURIDAD (ARQUITECTO)**: Se ha movido el módulo de procesamiento de PDF a la carpeta 	ools/arca_oc_stamper/ para evitar conflictos en el Core durante la sincronización (Modo Standalone).
> 
> **ACTUALIZACIÓN DE FIRMA**: Se ha incorporado a Dario Ponce (Production Supervisor) en el pie de página de los documentos procesados.



### 📜 HITO: Protocolo Raíz Refactorizado (IPL V6.1)
- **Nuevo Estándar**: Se ha oficializado GY_IPL_V6.md como el nuevo cargador inicial.
- **Manual de Estilo**: Integración de respuesta dinámica (Comandante vs Socrático).
- **Seguridad Operativa**: Anclaje mandatorio a la raíz C:\dev\Sonido_Liquido_V5.
- **Cierre Maestro**: Formalización de los 5 pasos de sincronización obligatoria.


- **Pre-Flight Check**: Se añadió la verificación obligatoria de IOWA al inicio de sesión para alertar sobre la disponibilidad de la memoria estratégica (RAG).


> [!CAUTION]
> **CAJA NEGRA - FALLO DE CIERRE (V6.1)**: El protocolo de cierre falló inicialmente porque el commit no incluyó archivos borrados/movidos. 
> **CAUSA**: Confianza en git commit sin git add . previo o flag -a. 
> **REMEDIACIÓN**: Rectificación manual ejecutada y comando de cierre actualizado en GY_IPL_V6.md para ser EXPLÍCITO.
