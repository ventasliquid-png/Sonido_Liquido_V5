import{r as k,w as K,m as G,o as Q,p as H,c as d,k as u,d as E,b as e,e as I,t as w,i as F,v as j,F as M,g as X,n as N,R as ne,M as ie,l as te,T as de,q as z,D as le,x as ue,f as q,h as W,P as Y,U as Z}from"./index-CbJ9Xo6G.js";import{u as oe}from"./pedidos-B1wW5O8Q.js";import{p as ce}from"./productosApi-B95eMTcM.js";const fe={key:0,class:"text-red-500"},pe={class:"relative flex gap-2"},me={class:"relative flex-1"},ve=["placeholder"],be={class:"py-1"},xe={key:1,class:"px-3 py-2 text-sm text-gray-400 italic"},ge={key:0,class:"px-3 py-1 text-[10px] font-bold text-gray-400 bg-gray-50 uppercase tracking-wider border-b border-gray-100 mt-1 first:mt-0"},ye=["data-index","onClick","onMouseenter"],he={class:"flex items-center gap-2"},we={key:0,class:"text-xs"},ee={__name:"SmartSelect",props:{modelValue:{type:[String,Number],default:null},options:{type:Array,default:()=>[]},label:{type:String,default:""},allowCreate:{type:Boolean,default:!0},placeholder:{type:String,default:"Seleccionar..."},priorityIds:{type:Array,default:()=>[]},required:{type:Boolean,default:!1}},emits:["update:modelValue","create-new"],setup(b,{emit:S}){const r=b,g=S,v=k(!1),p=k(""),c=k(-1),C=k(null),y=k(null),P=k(null);K(()=>r.modelValue,s=>{const n=r.options.find(m=>m.id===s);n?p.value=n.nombre||n.descripcion:r.options.length>0&&(p.value="")},{immediate:!0}),K(()=>r.options,()=>{const s=r.options.find(n=>n.id===r.modelValue);s&&(p.value=s.nombre||s.descripcion)});const D=G(()=>{let s=r.options;if(p.value){const n=p.value.toLowerCase(),m=r.options.find(x=>x.id===r.modelValue);(!m||(m.nombre||m.descripcion).toLowerCase()!==n)&&(s=r.options.filter(x=>(x.nombre||x.descripcion||"").toLowerCase().includes(n)))}if(r.priorityIds.length>0){const n=[],m=[];s.forEach(l=>{r.priorityIds.includes(l.id)?n.push({...l,_isPriority:!0}):m.push(l)});const x=[];return n.length>0&&(x.push({_type:"header",label:"HABITUALES DEL CLIENTE"}),x.push(...n),m.length>0&&x.push({_type:"header",label:"OTROS"})),x.push(...m),x}return s}),V=()=>{v.value=!0,c.value=-1,document.activeElement!==C.value&&C.value.focus()},_=()=>{v.value=!1,c.value=-1;const s=r.options.find(n=>n.id===r.modelValue);s?p.value=s.nombre||s.descripcion:p.value=""},O=s=>{s._type!=="header"&&(g("update:modelValue",s.id),p.value=s.nombre||s.descripcion,v.value=!1)},$=()=>{g("create-new"),_()},L=s=>{v.value||(v.value=!0),s.target.value===""&&g("update:modelValue",null)},T=s=>{if(s.key==="F4"){s.preventDefault(),$();return}if(s.key==="ArrowDown"){if(s.preventDefault(),!v.value){V();return}let n=c.value+1;for(;n<D.value.length;){if(!D.value[n]._type){c.value=n,B();return}n++}}else if(s.key==="ArrowUp"){s.preventDefault();let n=c.value-1;for(;n>=0;){if(!D.value[n]._type){c.value=n,B();return}n--}}else if(s.key==="Enter"){if(s.preventDefault(),v.value&&c.value>=0)O(D.value[c.value]);else if(v.value){const n=D.value.find(m=>!m._type);n&&O(n)}}else s.key==="Escape"?v.value&&(s.preventDefault(),s.stopPropagation(),_()):s.key==="Tab"&&v.value&&_()},B=()=>{ne(()=>{if(!y.value)return;y.value.querySelectorAll('li[data-selectable="true"]');const s=y.value.querySelector(`li[data-index="${c.value}"]`);s&&s.scrollIntoView({block:"nearest"})})},U=s=>{v.value&&P.value&&!P.value.contains(s.target)&&_()};return Q(()=>{document.addEventListener("click",U)}),H(()=>{document.removeEventListener("click",U)}),(s,n)=>(u(),d("div",{class:"w-full",ref_key:"containerRef",ref:P},[b.label?(u(),d("label",{key:0,class:"block text-xs font-bold text-gray-600 mb-1",onClick:n[0]||(n[0]=m=>C.value?.focus())},[I(w(b.label)+" ",1),b.required?(u(),d("span",fe,"*")):E("",!0)])):E("",!0),e("div",pe,[e("div",me,[F(e("input",{ref_key:"inputRef",ref:C,type:"text","onUpdate:modelValue":n[1]||(n[1]=m=>p.value=m),onInput:L,onKeydown:T,onFocus:V,class:"w-full border border-gray-300 rounded px-3 py-2 text-sm focus:border-[#54cb9b] focus:ring-1 focus:ring-[#54cb9b] focus:outline-none bg-white",placeholder:b.placeholder,autocomplete:"off"},null,40,ve),[[j,p.value]]),n[3]||(n[3]=e("div",{class:"absolute inset-y-0 right-0 flex items-center px-2 text-gray-400 pointer-events-none"},[e("svg",{class:"h-4 w-4",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z","clip-rule":"evenodd"})])],-1)),v.value?(u(),d("div",{key:0,class:"absolute z-50 w-full mt-1 bg-white border border-gray-200 rounded-md shadow-lg max-h-60 overflow-auto",ref_key:"listRef",ref:y},[e("ul",be,[b.allowCreate?(u(),d("li",{key:0,onClick:$,class:"px-3 py-2 text-sm text-[#54cb9b] font-bold hover:bg-green-50 cursor-pointer border-b border-gray-100 flex items-center gap-2"},[...n[2]||(n[2]=[e("span",null,"➕",-1),I(" Nuevo (F4) ",-1)])])):E("",!0),D.value.length===0?(u(),d("li",xe," No hay coincidencias ")):E("",!0),(u(!0),d(M,null,X(D.value,(m,x)=>(u(),d(M,{key:m.id||x},[m._type==="header"?(u(),d("li",ge,w(m.label),1)):(u(),d("li",{key:1,"data-index":x,"data-selectable":"true",onClick:l=>O(m),class:N(["px-3 py-2 text-sm cursor-pointer transition-colors flex justify-between items-center",{"bg-[#54cb9b] text-white":x===c.value,"text-gray-700 hover:bg-gray-100":x!==c.value}]),onMouseenter:l=>c.value=x},[e("div",he,[m._isPriority?(u(),d("span",we,"⭐")):E("",!0),e("span",null,w(m.nombre||m.descripcion),1)]),m.id===b.modelValue?(u(),d("span",{key:0,class:N(["text-xs font-bold",x===c.value?"text-white":"text-[#54cb9b]"])},"✓",2)):E("",!0)],42,ye))],64))),128))])],512)):E("",!0)]),b.allowCreate?(u(),d("button",{key:0,onClick:$,class:"px-3 py-2 bg-gray-100 border border-gray-300 rounded text-gray-600 hover:bg-gray-200 hover:text-gray-800 transition-colors font-bold text-sm flex items-center justify-center",title:"Crear Nuevo (F4)",type:"button",tabindex:"-1"}," [+] ")):E("",!0)])],512))}},ke={class:"h-full flex flex-col bg-[#021812] border-l border-emerald-900/30"},Ce={key:0,class:"flex flex-col items-center justify-center h-full text-white/30 p-6 text-center"},Ee={key:1,class:"flex flex-col h-full w-[400px]"},De={class:"h-16 flex items-center justify-between px-6 border-b border-emerald-900/30 bg-[#052e1e]/50 backdrop-blur-sm shrink-0"},Oe={class:"flex flex-col"},Pe={class:"font-outfit text-lg font-bold text-white tracking-wide"},Ae={class:"text-emerald-400"},Ne={class:"text-[10px] text-emerald-200/50 uppercase tracking-widest"},Ie={class:"flex-1 overflow-y-auto p-6 space-y-6 scrollbar-thin scrollbar-thumb-emerald-900/30 hover:scrollbar-thumb-emerald-900/50"},Re={class:"bg-emerald-900/10 p-4 rounded-lg border border-emerald-900/20 relative group/client"},_e={key:0,class:"flex items-center justify-between"},$e={class:"flex items-center gap-3"},Ue={class:"h-10 w-10 rounded-full bg-gradient-to-br from-emerald-900 to-green-900 flex items-center justify-center text-white font-bold text-sm border border-emerald-500/20 shrink-0"},Ve={class:"font-bold text-emerald-100 text-sm"},Se={class:"text-xs text-emerald-500/50"},Le={key:1},Te={class:"mb-4"},Be={class:"flex bg-[#051f15] rounded-lg p-1 border border-emerald-900/30"},Fe={class:"group relative"},je={class:"relative"},ze=["value"],Me={class:"bg-emerald-900/5 p-4 rounded-lg border border-emerald-900/10 mb-4"},qe={class:"flex gap-2 mb-2"},Xe={class:"flex-1"},Ke={class:"w-16"},Ge=["disabled"],Qe={class:"block text-[10px] uppercase tracking-wider font-bold text-emerald-500/70 mb-2 ml-1"},He={class:"space-y-2"},Je={class:"flex-1 pr-4"},We={class:"text-xs text-white font-medium mb-1"},Ye={class:"flex items-center gap-2"},Ze=["onUpdate:modelValue","onChange"],et={class:"relative"},tt=["onUpdate:modelValue","onChange"],lt={class:"text-right flex items-center gap-3"},ot={class:"text-xs font-bold text-emerald-200"},at=["onClick"],st={class:"bg-yellow-500/5 border-l-2 border-yellow-500/30 p-3 rounded-r relative group/nota"},rt={key:0,class:"flex justify-between items-start"},nt={class:"text-xs text-yellow-100/80 italic min-h-[1.5rem]"},it={key:1},dt={class:"p-6 border-t border-emerald-900/30 bg-[#02110c] shrink-0 space-y-4"},ut={class:"flex items-center justify-between"},ct={class:"text-2xl font-bold text-white font-mono"},ft={class:"flex gap-2"},pt={__name:"PedidoInspector",props:{modelValue:{type:Object,default:null}},emits:["close","update-status","delete-item","clone"],setup(b,{emit:S}){const r=b,g=S,v=oe(),p=te(),c=k(!1),C=k(!1),y=k(!1),P=k(null),D=k(""),V=k([]),_=k([]),O=k({producto_id:null,cantidad:1});Q(()=>{$(),window.addEventListener("keydown",A)}),H(()=>{window.removeEventListener("keydown",A)});const $=async()=>{try{const[i,o]=await Promise.all([de.getAll({type:"simple"}),ce.getAll({limit:1e3})]);V.value=i.data||[];const f=o.data||[];_.value=f.map(R=>({id:R.id,nombre:`${R.nombre} ($${R.precio_mayorista})`}))}catch(i){console.error("Error loading inspector options",i)}};K(()=>r.modelValue,i=>{c.value=!1,O.value={producto_id:null,cantidad:1}});const L=async i=>{if(i==="PENDIENTE"){const f=confirm(`DISCRECIÓN REQUERIDA:

¿Tipo de Operación para Reservar Stock?

[ACEPTAR] = Con Factura A/B (FISCAL)
[CANCELAR] = Solo Reserva Interna (X)`)?"FISCAL":"X";try{await v.updatePedido(r.modelValue.id,{estado:"PENDIENTE",tipo_comprobante:f}),r.modelValue.estado="PENDIENTE",r.modelValue.tipo_comprobante=f,p.add(`Activado como ${f==="FISCAL"?"FISCAL":"INTERNO (X)"}`,"success")}catch{p.add("Error actualizando pedido","error")}return}r.modelValue.estado=i,g("update-status",r.modelValue,i)},T=async i=>{if(i!==r.modelValue.tipo_comprobante)try{await v.updatePedido(r.modelValue.id,{tipo_comprobante:i}),r.modelValue.tipo_comprobante=i,p.add(`Tipo actualizado a ${i}`,"success")}catch{p.add("Error al cambiar tipo","error")}},B=()=>{P.value=r.modelValue.cliente?.id,c.value=!0},U=()=>{c.value=!1,P.value=null},s=async()=>{if(!P.value||P.value===r.modelValue.cliente?.id){U();return}try{await v.updatePedido(r.modelValue.id,{cliente_id:P.value}),p.add("Cliente actualizado","success"),c.value=!1,y.value=!0}catch{p.add("Error actualizando cliente","error")}},n=()=>{D.value=r.modelValue.nota||"",C.value=!0},m=()=>{C.value=!1,D.value=""},x=async()=>{if(D.value===r.modelValue.nota){m();return}try{await v.updatePedido(r.modelValue.id,{nota:D.value}),p.add("Nota actualizada","success"),C.value=!1,y.value=!0}catch{p.add("Error actualizando nota","error")}},l=async()=>{if(O.value.producto_id)try{await v.addPedidoItem(r.modelValue.id,{producto_id:O.value.producto_id,cantidad:O.value.cantidad,precio_unitario:0}),p.add("Item agregado","success"),O.value={producto_id:null,cantidad:1},y.value=!0}catch{p.add("Error agregando item","error")}},t=async i=>{try{await v.updatePedidoItem(r.modelValue.id,i.id,{cantidad:i.cantidad,precio_unitario:i.precio_unitario}),y.value=!0}catch{p.add("Error actualizando item","error")}},a=async i=>{const o=r.modelValue.items.length<=1;let f="¿Eliminar este item?";if(o&&(f="⚠️ CUIDADO: Al eliminar el último item, el pedido quedará vacío y pasará a estado ANULADO. ¿Continuar?"),!!confirm(f))try{await v.deletePedidoItem(r.modelValue.id,i),o?(await v.updatePedido(r.modelValue.id,{estado:"ANULADO"}),p.add("Pedido ANULADO por falta de items","warning")):p.add("Item eliminado","success"),y.value=!0}catch{p.add("Error eliminando item","error")}},h=()=>{g("close")},A=i=>{i.key==="F10"&&(i.preventDefault(),h()),i.key==="Escape"&&(i.preventDefault(),h())},ae=i=>i?new Date(i).toLocaleDateString("es-AR",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):"",J=i=>new Intl.NumberFormat("es-AR",{style:"currency",currency:"ARS"}).format(i),se=i=>i?i.substring(0,1).toUpperCase():"?",re=i=>{switch(i){case"PENDIENTE":return"text-white";case"CUMPLIDO":return"text-yellow-400";case"ANULADO":return"text-red-400";case"PRESUPUESTO":return"text-purple-300";case"BORRADOR":return"text-gray-400";case"CLONADO":return"text-pink-500";case"INTERNO":return"text-purple-300";default:return"text-white"}};return(i,o)=>(u(),d("div",ke,[b.modelValue?(u(),d("div",Ee,[e("div",De,[e("div",Oe,[e("h2",Pe,[o[9]||(o[9]=I(" Pedido ",-1)),e("span",Ae,"#"+w(b.modelValue.id),1)]),e("span",Ne,w(ae(b.modelValue.fecha)),1)]),e("button",{onClick:h,class:"h-8 w-8 rounded-full flex items-center justify-center text-white/40 hover:text-white hover:bg-white/10 transition-all",title:"Cerrar (ESC)"},[...o[10]||(o[10]=[e("i",{class:"fas fa-times"},null,-1)])])]),e("div",Ie,[e("div",Re,[c.value?(u(),d("div",Le,[o[12]||(o[12]=e("label",{class:"block text-[10px] uppercase tracking-wider font-bold text-emerald-500/70 mb-2"},"Cambiar Cliente",-1)),z(ee,{modelValue:P.value,"onUpdate:modelValue":o[0]||(o[0]=f=>P.value=f),options:V.value,placeholder:"Buscar cliente...",allowCreate:!1,class:"mb-2"},null,8,["modelValue","options"]),e("div",{class:"flex justify-end gap-2 mt-2"},[e("button",{onClick:U,class:"text-xs text-white/50 hover:text-white"},"Cancelar"),e("button",{onClick:s,class:"text-xs bg-emerald-600 text-white px-2 py-1 rounded font-bold"},"Guardar")])])):(u(),d("div",_e,[e("div",$e,[e("div",Ue,w(se(b.modelValue.cliente?.razon_social)),1),e("div",null,[e("h3",Ve,w(b.modelValue.cliente?.razon_social),1),e("p",Se,"ID: "+w(b.modelValue.cliente?.id),1)])]),e("button",{onClick:B,class:"text-emerald-500/30 hover:text-emerald-400 transition-colors opacity-0 group-hover/client:opacity-100",title:"Cambiar Cliente"},[...o[11]||(o[11]=[e("i",{class:"fas fa-pencil-alt"},null,-1)])])]))]),e("div",Te,[o[13]||(o[13]=e("label",{class:"block text-[10px] uppercase tracking-wider font-bold text-emerald-500/70 mb-1.5 ml-1"},"Tipo de Comprobante",-1)),e("div",Be,[e("button",{onClick:o[1]||(o[1]=f=>T("FISCAL")),class:N(["flex-1 py-1.5 rounded text-xs font-bold transition-all",b.modelValue.tipo_comprobante==="FISCAL"?"bg-emerald-600 text-white shadow-lg":"text-white/30 hover:text-white/50"])}," FISCAL (A/B) ",2),e("button",{onClick:o[2]||(o[2]=f=>T("X")),class:N(["flex-1 py-1.5 rounded text-xs font-bold transition-all",b.modelValue.tipo_comprobante==="X"?"bg-purple-600/80 text-white shadow-lg":"text-white/30 hover:text-white/50"])}," PRESUPUESTO X ",2)])]),e("div",Fe,[o[16]||(o[16]=e("label",{class:"block text-[10px] uppercase tracking-wider font-bold text-emerald-500/70 mb-1.5 ml-1"},"Estado del Flujo",-1)),e("div",je,[e("select",{value:b.modelValue.estado,onChange:o[3]||(o[3]=f=>L(f.target.value)),class:N(["w-full bg-[#051f15] text-white border border-emerald-900/30 rounded-lg px-4 py-2.5 focus:outline-none focus:border-emerald-400 focus:ring-1 focus:ring-emerald-400/50 transition-all appearance-none font-bold uppercase tracking-wide",re(b.modelValue.estado)])},[...o[14]||(o[14]=[le('<option value="BORRADOR" class="text-gray-400 font-bold bg-white" data-v-a3fb8f04>BORRADOR (Trabajo en Progreso)</option><option value="PRESUPUESTO" class="text-purple-600 font-bold bg-white" data-v-a3fb8f04>PRESUPUESTO (Cotización)</option><option value="PENDIENTE" class="text-emerald-600 bg-white font-bold" data-v-a3fb8f04>PENDIENTE (Aprobado/En Curso)</option><option value="CUMPLIDO" class="text-blue-600 bg-white font-bold" data-v-a3fb8f04>CUMPLIDO (Entregado)</option><option value="ANULADO" class="text-red-600 bg-white font-bold" data-v-a3fb8f04>ANULADO</option>',5)])],42,ze),o[15]||(o[15]=e("i",{class:"fas fa-chevron-down absolute right-4 top-1/2 -translate-y-1/2 text-white/30 pointer-events-none"},null,-1))])]),e("div",Me,[o[18]||(o[18]=e("label",{class:"block text-[10px] uppercase tracking-wider font-bold text-emerald-500/70 mb-2"},"Agregar Item",-1)),e("div",qe,[e("div",Xe,[z(ee,{modelValue:O.value.producto_id,"onUpdate:modelValue":o[4]||(o[4]=f=>O.value.producto_id=f),options:_.value,placeholder:"Buscar producto...",allowCreate:!1,class:"smart-select-container"},null,8,["modelValue","options"])]),e("div",Ke,[F(e("input",{type:"number","onUpdate:modelValue":o[5]||(o[5]=f=>O.value.cantidad=f),min:"1",class:"w-full bg-white text-black border border-gray-300 rounded px-2 py-2 text-sm text-center font-bold focus:outline-none focus:border-emerald-500"},null,512),[[j,O.value.cantidad,void 0,{number:!0}]])])]),e("button",{onClick:l,disabled:!O.value.producto_id||O.value.cantidad<1,class:"w-full py-1.5 bg-emerald-600/20 hover:bg-emerald-600 text-emerald-400 hover:text-white rounded text-xs font-bold uppercase tracking-wider transition-all disabled:opacity-50 disabled:cursor-not-allowed"},[...o[17]||(o[17]=[e("i",{class:"fas fa-plus mr-1"},null,-1),I(" Agregar ",-1)])],8,Ge)]),e("div",null,[e("label",Qe,"Items del Pedido ("+w(b.modelValue.items.length)+")",1),e("div",He,[(u(!0),d(M,null,X(b.modelValue.items,f=>(u(),d("div",{key:f.id,class:"flex justify-between items-start p-3 bg-emerald-900/5 rounded border border-emerald-900/10 group/item hover:bg-emerald-900/10 transition-colors"},[e("div",Je,[e("p",We,w(f.producto?.nombre||"Producto"),1),e("div",Ye,[F(e("input",{type:"number","onUpdate:modelValue":R=>f.cantidad=R,onChange:R=>t(f),class:"w-12 bg-emerald-900/30 text-emerald-100 border border-emerald-500/30 rounded px-1 py-0.5 text-[10px] text-center focus:outline-none focus:border-emerald-400 no-spinner",min:"1"},null,40,Ze),[[j,f.cantidad,void 0,{number:!0}]]),o[20]||(o[20]=e("span",{class:"text-[10px] text-white/40"},"x",-1)),e("div",et,[o[19]||(o[19]=e("span",{class:"absolute left-1.5 top-1/2 -translate-y-1/2 text-[10px] text-emerald-500/50"},"$",-1)),F(e("input",{type:"number","onUpdate:modelValue":R=>f.precio_unitario=R,onChange:R=>t(f),class:"w-20 bg-emerald-900/30 text-emerald-100 border border-emerald-500/30 rounded pl-4 pr-1 py-0.5 text-[10px] text-right focus:outline-none focus:border-emerald-400 no-spinner",min:"0",step:"0.01"},null,40,tt),[[j,f.precio_unitario,void 0,{number:!0}]])])])]),e("div",lt,[e("p",ot,w(J(f.cantidad*f.precio_unitario)),1),e("button",{onClick:R=>a(f.id),class:"text-red-500/30 hover:text-red-400 opacity-0 group-hover/item:opacity-100 transition-all",title:"Eliminar Item"},[...o[21]||(o[21]=[e("i",{class:"fas fa-trash"},null,-1)])],8,at)])]))),128))])]),e("div",st,[o[23]||(o[23]=e("label",{class:"block text-[10px] uppercase tracking-wider font-bold text-yellow-500/70 mb-1"},"Nota",-1)),C.value?(u(),d("div",it,[F(e("textarea",{"onUpdate:modelValue":o[6]||(o[6]=f=>D.value=f),class:"w-full bg-[#051f15] text-yellow-100 border border-yellow-500/30 rounded p-2 text-xs italic focus:outline-none focus:border-yellow-500",rows:"3"},null,512),[[j,D.value]]),e("div",{class:"flex justify-end gap-2 mt-2"},[e("button",{onClick:m,class:"text-xs text-white/50 hover:text-white"},"Cancelar"),e("button",{onClick:x,class:"text-xs bg-yellow-600/50 hover:bg-yellow-600 text-white px-2 py-1 rounded font-bold"},"Guardar")])])):(u(),d("div",rt,[e("p",nt,w(b.modelValue.nota||"Sin nota"),1),e("button",{onClick:n,class:"text-yellow-500/30 hover:text-yellow-400 opacity-0 group-hover/nota:opacity-100 transition-opacity",title:"Editar Nota"},[...o[22]||(o[22]=[e("i",{class:"fas fa-pencil-alt"},null,-1)])])]))])]),e("div",dt,[e("div",ut,[o[24]||(o[24]=e("span",{class:"text-sm font-bold text-white/50 uppercase tracking-widest"},"Total Pedido",-1)),e("span",ct,w(J(b.modelValue.total)),1)]),e("div",ft,[e("button",{onClick:o[7]||(o[7]=f=>g("clone")),class:"px-4 py-3 bg-emerald-900/30 hover:bg-emerald-900/50 text-emerald-400 border border-emerald-500/20 rounded-lg font-bold transition-all text-xs uppercase",title:"Clonar este pedido"},[...o[25]||(o[25]=[e("i",{class:"fas fa-copy mr-1"},null,-1),I(" Clonar ",-1)])]),e("button",{onClick:h,class:"flex-1 py-3 bg-gradient-to-r from-emerald-800 to-emerald-700 hover:from-emerald-700 hover:to-emerald-600 text-white rounded-lg font-bold shadow-lg shadow-black/20 hover:shadow-emerald-500/10 transition-all active:scale-[0.98] text-xs uppercase",title:"Cerrar / Aceptar (F10)"},[...o[26]||(o[26]=[e("i",{class:"fas fa-check mr-1"},null,-1),I(" Aceptar (F10) ",-1)])])])])])):(u(),d("div",Ce,[...o[8]||(o[8]=[e("i",{class:"fas fa-shopping-cart text-4xl mb-4 text-emerald-900/50"},null,-1),e("p",{class:"text-sm"},[I("Seleccione un pedido"),e("br"),I("para ver sus detalles")],-1)])]))]))}},mt=ie(pt,[["__scopeId","data-v-a3fb8f04"]]),vt={class:"flex h-screen w-full bg-[#021812] text-gray-200 overflow-hidden font-sans"},bt={class:"flex flex-1 flex-col relative min-w-0"},xt={class:"relative z-20 flex h-16 items-center justify-between border-b border-emerald-900/20 bg-[#052e1e]/50 px-6 backdrop-blur-sm shrink-0"},gt={class:"flex items-center gap-4"},yt={class:"relative"},ht={class:"flex bg-emerald-900/10 rounded-lg p-1 border border-emerald-900/20"},wt=["onClick"],kt={class:"flex-1 overflow-y-auto p-6 scrollbar-thin scrollbar-track-emerald-900/10 scrollbar-thumb-emerald-900/30"},Ct={class:"flex flex-col gap-2"},Et={class:"flex items-center justify-between px-4 py-2 text-xs font-bold text-emerald-900/50 uppercase tracking-wider select-none"},Dt=["onDblclick","onContextmenu"],Ot={class:"w-20 font-mono text-emerald-500"},Pt={class:"w-32 text-sm text-emerald-200/70 flex flex-col leading-tight"},At={class:"text-[10px] text-emerald-200/40"},Nt={class:"flex items-center gap-4 flex-1"},It={class:"h-8 w-8 rounded-full bg-gradient-to-br from-emerald-900 to-green-900 flex items-center justify-center text-white font-bold text-xs border border-emerald-500/20 shrink-0"},Rt={class:"min-w-0 flex-1"},_t={class:"font-bold text-emerald-100 truncate"},$t={key:0,class:"text-xs text-emerald-200/30 font-mono italic truncate"},Ut={class:"w-32 text-right font-mono text-emerald-100 font-bold"},Vt={class:"w-32 flex justify-center relative group/status"},St=["value","onChange"],Lt={key:0,class:"flex flex-col items-center justify-center py-20 text-emerald-900/40"},Tt={key:1,class:"flex flex-col items-center justify-center py-20 text-emerald-500"},Bt={key:0,class:"absolute inset-y-0 right-0 z-30 w-full max-w-md shadow-2xl"},Mt={__name:"PedidoList",setup(b){const S=ue(),r=te(),g=oe(),v=k(""),p=k("all"),c=k(null),C=k("fecha"),y=k("desc"),P=G(()=>{const l={all:g.pedidos.length,PENDIENTE:g.pedidos.filter(t=>t.estado==="PENDIENTE").length,BORRADOR:g.pedidos.filter(t=>t.estado==="BORRADOR"||t.estado==="CLONADO").length,CUMPLIDO:g.pedidos.filter(t=>t.estado==="CUMPLIDO").length,PRESUPUESTO:g.pedidos.filter(t=>t.estado==="PRESUPUESTO"||t.estado==="INTERNO").length,ANULADO:g.pedidos.filter(t=>t.estado==="ANULADO").length};return[{key:"all",label:`Todos (${l.all})`,activeClass:"bg-emerald-600/70 text-white shadow-md ring-1 ring-emerald-500"},{key:"PENDIENTE",label:`Pendientes (${l.PENDIENTE})`,activeClass:"bg-white/90 text-emerald-950 font-bold shadow-md ring-1 ring-white"},{key:"BORRADOR",label:`Borradores (${l.BORRADOR})`,activeClass:"bg-gray-500 text-white font-bold shadow-md ring-1 ring-gray-400"},{key:"CUMPLIDO",label:`Completados (${l.CUMPLIDO})`,activeClass:"bg-yellow-500/80 text-black font-bold shadow-md ring-1 ring-yellow-400"},{key:"PRESUPUESTO",label:`Presupuesto (${l.PRESUPUESTO})`,activeClass:"bg-purple-600/70 text-white shadow-md ring-1 ring-purple-500"},{key:"ANULADO",label:`Anulados (${l.ANULADO})`,activeClass:"bg-red-600/70 text-white shadow-md ring-1 ring-red-500"}]}),D=async()=>{const l={limit:100};await g.fetchPedidos(l)},V=l=>{p.value=l},_=G(()=>{let l=g.pedidos;if(p.value!=="all"&&(p.value==="BORRADOR"?l=l.filter(t=>t.estado==="BORRADOR"||t.estado==="CLONADO"):p.value==="PRESUPUESTO"?l=l.filter(t=>t.estado==="PRESUPUESTO"||t.estado==="INTERNO"):l=l.filter(t=>t.estado===p.value)),v.value){const t=v.value.toLowerCase();l=l.filter(a=>{const h=String(a.id).includes(t),A=a.cliente?.razon_social?.toLowerCase().includes(t);return h||A})}return l.sort((t,a)=>{let h,A;switch(C.value){case"id":h=t.id,A=a.id;break;case"fecha":h=new Date(t.fecha),A=a.fecha?new Date(a.fecha):new Date(0);break;case"cliente":h=(t.cliente?.razon_social||"").toLowerCase(),A=(a.cliente?.razon_social||"").toLowerCase();break;case"total":h=t.total,A=a.total;break;case"estado":h=(t.estado||"").toLowerCase(),A=(a.estado||"").toLowerCase();break;default:h=t.id,A=a.id}return h<A?y.value==="asc"?-1:1:h>A?y.value==="asc"?1:-1:0}),l}),O=l=>{switch(l){case"PENDIENTE":return"bg-white/10 text-white border-white/20 font-bold";case"BORRADOR":return"bg-gray-500/20 text-gray-400 border-gray-500/30 font-bold";case"CLONADO":return"bg-pink-500/20 text-pink-400 border-pink-500/30 font-bold";case"CUMPLIDO":return"bg-yellow-500/10 text-yellow-400 border-yellow-500/20 font-bold";case"ANULADO":return"bg-red-500/10 text-red-400 border-red-500/20 font-bold";case"PRESUPUESTO":return"bg-purple-600/40 text-purple-300 border-purple-500/50 font-bold";case"INTERNO":return"bg-purple-600/40 text-purple-300 border-purple-500/50 font-bold";default:return"bg-gray-500/10 text-gray-400 border-gray-500/20 font-bold"}},$=l=>{c.value=l},L=async(l,t)=>{if(l.estado!==t)try{await g.updatePedido(l.id,{estado:t}),r.add(`Pedido #${l.id} actualizado a ${t}`,"success");const a=g.pedidos.find(h=>h.id===l.id);a&&c.value&&c.value.id===l.id&&(c.value=a)}catch{r.add("Error actualizando estado","error")}},T=async()=>{if(c.value&&confirm(`¿Estás seguro de CLONAR el Pedido #${c.value.id}?
Se creará una copia nueva en estado PENDIENTE.`))try{const l=await g.clonePedido(c.value.id);r.add(`Pedido clonado con éxito (ID: ${l.id})`,"success"),c.value=null;const t=document.querySelector(".overflow-y-auto");t&&(t.scrollTop=0)}catch{r.add("Error clonando pedido","error")}},B=async l=>{if(c.value&&confirm("¿Seguro que deseas eliminar este item?"))try{await g.deletePedidoItem(c.value.id,l),r.add("Item eliminado","success")}catch{r.add("Error eliminando item","error")}};Q(()=>{D(),window.addEventListener("keydown",U)}),H(()=>{window.removeEventListener("keydown",U)});const U=l=>{l.key==="F4"&&(l.preventDefault(),S.push("/ventas/tactico"))},s=l=>l?new Date(l).toLocaleDateString("es-AR",{day:"2-digit",month:"2-digit",year:"2-digit",hour:"2-digit",minute:"2-digit"}):"-",n=l=>new Intl.NumberFormat("es-AR",{style:"currency",currency:"ARS"}).format(l),m=l=>l?l.substring(0,1).toUpperCase():"?",x=l=>{C.value===l?y.value=y.value==="asc"?"desc":"asc":(C.value=l,y.value="asc",(l==="fecha"||l==="id")&&(y.value="desc"))};return(l,t)=>(u(),d("div",vt,[e("main",bt,[e("header",xt,[t[14]||(t[14]=e("div",null,[e("h1",{class:"font-outfit text-xl font-semibold text-white"}," Gestión de Pedidos "),e("p",{class:"text-xs text-emerald-400/50 font-medium uppercase tracking-wider"},"Tablero Táctico")],-1)),e("div",gt,[e("div",yt,[t[10]||(t[10]=e("i",{class:"fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-emerald-500/50"},null,-1)),F(e("input",{"onUpdate:modelValue":t[0]||(t[0]=a=>v.value=a),type:"text",placeholder:"Buscar cliente o ID...",class:"h-9 w-64 rounded-full border border-emerald-900/30 bg-[#020f0a] pl-10 pr-4 text-sm text-emerald-100 placeholder-emerald-900/50 focus:border-emerald-500 focus:outline-none focus:ring-1 focus:ring-emerald-500"},null,512),[[j,v.value]])]),t[12]||(t[12]=e("div",{class:"h-6 w-px bg-emerald-900/20"},null,-1)),e("div",ht,[(u(!0),d(M,null,X(P.value,a=>(u(),d("button",{key:a.key,onClick:h=>V(a.key),class:N(["px-3 py-1 text-xs font-bold rounded-md transition-all whitespace-nowrap",p.value===a.key?a.activeClass:"text-emerald-100/40 hover:text-emerald-100 hover:bg-emerald-500/10"])},w(a.label),11,wt))),128))]),t[13]||(t[13]=e("div",{class:"h-6 w-px bg-emerald-900/20"},null,-1)),e("button",{onClick:D,class:"p-2 text-emerald-500 hover:text-emerald-300 transition-colors",title:"Recargar"},[e("i",{class:N(["fas fa-sync-alt",{"animate-spin":q(g).isLoading}])},null,2)]),e("button",{onClick:t[1]||(t[1]=a=>q(S).push("/ventas/tactico")),class:"ml-2 flex items-center gap-2 rounded-lg bg-emerald-600 px-4 py-1.5 text-sm font-bold text-white shadow-lg shadow-emerald-500/20 transition-all hover:bg-emerald-500 hover:shadow-emerald-500/40",title:"Nuevo Pedido (F4)"},[...t[11]||(t[11]=[e("i",{class:"fas fa-plus"},null,-1),e("span",{class:"hidden sm:inline"},"Nuevo",-1)])])])]),e("div",kt,[e("div",Ct,[e("div",Et,[e("div",{onClick:t[2]||(t[2]=a=>x("id")),class:"w-20 cursor-pointer hover:text-emerald-500 flex items-center gap-1"},[t[15]||(t[15]=I(" ID ",-1)),C.value==="id"?(u(),d("i",{key:0,class:N(y.value==="asc"?"fas fa-chevron-up":"fas fa-chevron-down")},null,2)):E("",!0)]),e("div",{onClick:t[3]||(t[3]=a=>x("fecha")),class:"w-32 cursor-pointer hover:text-emerald-500 flex items-center gap-1"},[t[16]||(t[16]=I(" Fecha ",-1)),C.value==="fecha"?(u(),d("i",{key:0,class:N(y.value==="asc"?"fas fa-chevron-up":"fas fa-chevron-down")},null,2)):E("",!0)]),e("div",{onClick:t[4]||(t[4]=a=>x("cliente")),class:"flex-1 cursor-pointer hover:text-emerald-500 flex items-center gap-1"},[t[17]||(t[17]=I(" Cliente ",-1)),C.value==="cliente"?(u(),d("i",{key:0,class:N(y.value==="asc"?"fas fa-chevron-up":"fas fa-chevron-down")},null,2)):E("",!0)]),e("div",{onClick:t[5]||(t[5]=a=>x("total")),class:"w-32 text-right cursor-pointer hover:text-emerald-500 flex items-center justify-end gap-1"},[t[18]||(t[18]=I(" Total ",-1)),C.value==="total"?(u(),d("i",{key:0,class:N(y.value==="asc"?"fas fa-chevron-up":"fas fa-chevron-down")},null,2)):E("",!0)]),e("div",{onClick:t[6]||(t[6]=a=>x("estado")),class:"w-32 text-center cursor-pointer hover:text-emerald-500 flex items-center justify-center gap-1"},[t[19]||(t[19]=I(" Estado ",-1)),C.value==="estado"?(u(),d("i",{key:0,class:N(y.value==="asc"?"fas fa-chevron-up":"fas fa-chevron-down")},null,2)):E("",!0)]),t[20]||(t[20]=e("div",{class:"w-10"},null,-1))]),(u(!0),d(M,null,X(_.value,a=>(u(),d("div",{key:a.id,class:"group flex items-center justify-between p-3 rounded-lg border border-emerald-900/10 bg-emerald-900/5 hover:bg-emerald-900/10 cursor-pointer transition-colors",onDblclick:h=>$(a),onContextmenu:W(h=>$(a),["prevent"])},[e("div",Ot," #"+w(a.id),1),e("div",Pt,[e("span",null,w(s(a.fecha).split(" ")[0]),1),e("span",At,w(s(a.fecha).split(" ")[1]),1)]),e("div",Nt,[e("div",It,w(m(a.cliente?.razon_social)),1),e("div",Rt,[e("h3",_t,w(a.cliente?.razon_social||"Cliente Desconocido"),1),a.nota?(u(),d("p",$t,w(a.nota),1)):E("",!0)])]),e("div",Ut,w(n(a.total)),1),e("div",Vt,[e("span",{class:N(["px-2 py-0.5 rounded text-[10px] font-bold uppercase tracking-wide border transition-all",O(a.estado)])},w(a.estado),3),e("select",{value:a.estado,onClick:t[7]||(t[7]=W(()=>{},["stop"])),onChange:h=>L(a,h.target.value),class:"absolute inset-0 opacity-0 w-full h-full cursor-pointer",title:"Cambiar Estado"},[...t[21]||(t[21]=[le('<option value="BORRADOR" class="text-gray-500 bg-white font-bold">BORRADOR</option><option value="PENDIENTE" class="text-black bg-white">PENDIENTE</option><option value="CUMPLIDO" class="text-black bg-white">CUMPLIDO</option><option value="ANULADO" class="text-black bg-white">ANULADO</option><option value="PRESUPUESTO" class="text-black bg-white">PRESUPUESTO</option>',5)])],40,St)]),t[22]||(t[22]=e("div",{class:"w-10 flex justify-end"},[e("i",{class:"fas fa-chevron-right text-emerald-900/30 group-hover:text-emerald-500/50 transition-colors"})],-1))],40,Dt))),128)),_.value.length===0&&!q(g).isLoading?(u(),d("div",Lt,[...t[23]||(t[23]=[e("i",{class:"fas fa-box-open text-4xl mb-4"},null,-1),e("p",null,"No se encontraron pedidos",-1)])])):E("",!0),q(g).isLoading?(u(),d("div",Tt,[...t[24]||(t[24]=[e("i",{class:"fas fa-spinner fa-spin text-4xl mb-4"},null,-1),e("p",null,"Cargando...",-1)])])):E("",!0)])]),z(Z,{"enter-active-class":"transform transition ease-in-out duration-300","enter-from-class":"translate-x-full","enter-to-class":"translate-x-0","leave-active-class":"transform transition ease-in-out duration-300","leave-from-class":"translate-x-0","leave-to-class":"translate-x-full"},{default:Y(()=>[c.value?(u(),d("div",Bt,[z(mt,{"model-value":c.value,onClose:t[8]||(t[8]=a=>c.value=null),onUpdateStatus:L,onClone:T,onDeleteItem:B},null,8,["model-value"])])):E("",!0)]),_:1}),z(Z,{"enter-active-class":"transition-opacity ease-linear duration-300","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-active-class":"transition-opacity ease-linear duration-300","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:Y(()=>[c.value?(u(),d("div",{key:0,onClick:t[9]||(t[9]=a=>c.value=null),class:"absolute inset-0 bg-black/50 z-20 backdrop-blur-sm"})):E("",!0)]),_:1})])]))}};export{Mt as default};
