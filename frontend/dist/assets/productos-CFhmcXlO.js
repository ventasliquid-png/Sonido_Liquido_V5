import{K as a,L as k,r as n,a as B,l as T,T as y}from"./index-Dcx7StCk.js";const i={getAll(e={}){return a.get("/productos/",{params:e})},getById(e){return a.get(`/productos/${e}`)},create(e){return a.post("/productos/",e)},update(e,c){return a.put(`/productos/${e}`,c)},toggleActive(e){return a.delete(`/productos/${e}`)}},p={getAll(){return a.get("/productos/rubros")},create(e){return a.post("/productos/rubros",e)},update(e,c){return a.put(`/productos/rubros/${e}`,c)},delete(e){return a.delete(`/productos/rubros/${e}`)},getDependencies(e){return a.get("/bypass/check_rubro_deps",{params:{rubro_id:e}})},getProducts(e){return a.get(`/productos/rubros/${e}/productos`)},migrateAndDelete(e,c){return a.post(`/productos/rubros/${e}/migrate_and_delete`,c)},bulkMove(e){return a.post("/productos/rubros/bulk_move",e)}},D={getAll(e){return a.get("/proveedores/",{params:e})},create(e){return a.post("/proveedores/",e)},update(e,c){return a.put(`/proveedores/${e}`,c)},delete(e){return a.delete(`/proveedores/${e}`)}},K=k("productos",()=>{const e=n([]),c=n([]),f=n([]),g=n([]),h=n([]),d=n(null),u=n(!1),b=B({search:"",rubro_id:null,activo:!0}),t=T();async function E(){u.value=!0;try{const r={...b};r.search||delete r.search,r.rubro_id===null&&delete r.rubro_id;const o=await i.getAll(r);e.value=o.data}catch(r){console.error("Error fetching productos:",r),t.add("Error al cargar productos","error")}finally{u.value=!1}}async function w(){try{const r=await p.getAll();c.value=r.data}catch(r){console.error("Error fetching rubros:",r),t.add("Error al cargar rubros","error")}}async function m(){try{const r=await y.getUnidades();f.value=r.data}catch(r){console.error("Error fetching unidades:",r),t.add("Error al cargar unidades","error")}}async function A(){try{const r=await y.getTasasIva();g.value=r.data}catch(r){console.error("Error fetching tasas iva:",r),t.add("Error al cargar tasas IVA","error")}}async function I(){try{const r=await D.getAll();h.value=r.data}catch(r){console.error("Error fetching proveedores:",r),t.add("Error al cargar proveedores","error")}}async function P(r){u.value=!0;try{const o=await i.getById(r);return d.value=o.data,o.data}catch(o){return console.error("Error fetching producto:",o),t.add("Error al cargar el producto","error"),null}finally{u.value=!1}}async function x(r){u.value=!0;try{const o=await i.create(r);return e.value.push(o.data),t.add("Producto creado exitosamente","success"),o.data}catch(o){throw console.error("Error creating producto:",o),t.add("Error al crear producto","error"),o}finally{u.value=!1}}async function _(r,o){u.value=!0;try{const s=await i.update(r,o),l=e.value.findIndex(v=>v.id===r);return l!==-1&&(e.value[l]=s.data),d.value&&d.value.id===r&&(d.value=s.data),t.add("Producto actualizado exitosamente","success"),s.data}catch(s){throw console.error("Error updating producto:",s),t.add("Error al actualizar producto","error"),s}finally{u.value=!1}}async function $(r){u.value=!0;try{await i.toggleActive(r);const o=e.value.findIndex(s=>s.id===r);o!==-1&&(e.value[o].activo=!e.value[o].activo),d.value&&d.value.id===r&&(d.value.activo=!d.value.activo),t.add("Estado del producto actualizado","success")}catch(o){console.error("Error toggling producto status:",o),t.add("Error al cambiar estado del producto","error")}finally{u.value=!1}}async function R(r){try{const o=await p.create(r);return c.value.push(o.data),t.add("Rubro creado correctamente","success"),o.data}catch(o){throw console.error("Error creating rubro:",o),t.add("Error al crear rubro","error"),o}}async function z(r,o){try{const s=await p.update(r,o),l=c.value.findIndex(v=>v.id===r);return l!==-1&&(c.value[l]=s.data),t.add("Rubro actualizado correctamente","success"),s.data}catch(s){throw console.error("Error updating rubro:",s),t.add("Error al actualizar rubro","error"),s}}async function S(r){try{await p.delete(r),c.value=c.value.filter(o=>o.id!==r),t.add("Rubro eliminado","success")}catch(o){throw console.error("Error deleting rubro:",o),t.add("Error al eliminar rubro","error"),o}}return{productos:e,rubros:c,unidades:f,tasasIva:g,proveedores:h,currentProducto:d,filters:b,loading:u,fetchProductos:E,fetchRubros:w,fetchUnidades:m,fetchTasasIva:A,fetchProveedores:I,fetchProductoById:P,createProducto:x,updateProducto:_,toggleEstado:$,createRubro:R,updateRubro:z,deleteRubro:S}});export{K as u};
