import{K as s,L as k,r as d,a as B,l as D,Z as y}from"./index-CbJ9Xo6G.js";import{p as i}from"./productosApi-B95eMTcM.js";const p={getAll(){return s.get("/productos/rubros")},create(o){return s.post("/productos/rubros",o)},update(o,c){return s.put(`/productos/rubros/${o}`,c)},delete(o){return s.delete(`/productos/rubros/${o}`)},getDependencies(o){return s.get("/bypass/check_rubro_deps",{params:{rubro_id:o}})},getProducts(o){return s.get(`/productos/rubros/${o}/productos`)},migrateAndDelete(o,c){return s.post(`/productos/rubros/${o}/migrate_and_delete`,c)},bulkMove(o){return s.post("/productos/rubros/bulk_move",o)}},T={getAll(o){return s.get("/proveedores/",{params:o})},create(o){return s.post("/proveedores/",o)},update(o,c){return s.put(`/proveedores/${o}`,c)},delete(o){return s.delete(`/proveedores/${o}`)}},L=k("productos",()=>{const o=d([]),c=d([]),f=d([]),g=d([]),h=d([]),n=d(null),u=d(!1),b=B({search:"",rubro_id:null,activo:!0}),a=D();async function E(){u.value=!0;try{const r={...b};r.search||delete r.search,r.rubro_id===null&&delete r.rubro_id;const e=await i.getAll(r);o.value=e.data}catch(r){console.error("Error fetching productos:",r),a.add("Error al cargar productos","error")}finally{u.value=!1}}async function m(){try{const r=await p.getAll();c.value=r.data}catch(r){console.error("Error fetching rubros:",r),a.add("Error al cargar rubros","error")}}async function w(){try{const r=await y.getUnidades();f.value=r.data}catch(r){console.error("Error fetching unidades:",r),a.add("Error al cargar unidades","error")}}async function A(){try{const r=await y.getTasasIva();g.value=r.data}catch(r){console.error("Error fetching tasas iva:",r),a.add("Error al cargar tasas IVA","error")}}async function P(){try{const r=await T.getAll();h.value=r.data}catch(r){console.error("Error fetching proveedores:",r),a.add("Error al cargar proveedores","error")}}async function x(r){u.value=!0;try{const e=await i.getById(r);return n.value=e.data,e.data}catch(e){return console.error("Error fetching producto:",e),a.add("Error al cargar el producto","error"),null}finally{u.value=!1}}async function I(r){u.value=!0;try{const e=await i.create(r);return o.value.push(e.data),a.add("Producto creado exitosamente","success"),e.data}catch(e){throw console.error("Error creating producto:",e),a.add("Error al crear producto","error"),e}finally{u.value=!1}}async function _(r,e){u.value=!0;try{const t=await i.update(r,e),l=o.value.findIndex(v=>v.id===r);return l!==-1&&(o.value[l]=t.data),n.value&&n.value.id===r&&(n.value=t.data),a.add("Producto actualizado exitosamente","success"),t.data}catch(t){throw console.error("Error updating producto:",t),a.add("Error al actualizar producto","error"),t}finally{u.value=!1}}async function R(r){u.value=!0;try{await i.toggleActive(r);const e=o.value.findIndex(t=>t.id===r);e!==-1&&(o.value[e].activo=!o.value[e].activo),n.value&&n.value.id===r&&(n.value.activo=!n.value.activo),a.add("Estado del producto actualizado","success")}catch(e){console.error("Error toggling producto status:",e),a.add("Error al cambiar estado del producto","error")}finally{u.value=!1}}async function $(r){try{const e=await p.create(r);return c.value.push(e.data),a.add("Rubro creado correctamente","success"),e.data}catch(e){throw console.error("Error creating rubro:",e),a.add("Error al crear rubro","error"),e}}async function z(r,e){try{const t=await p.update(r,e),l=c.value.findIndex(v=>v.id===r);return l!==-1&&(c.value[l]=t.data),a.add("Rubro actualizado correctamente","success"),t.data}catch(t){throw console.error("Error updating rubro:",t),a.add("Error al actualizar rubro","error"),t}}async function S(r){try{await p.delete(r),c.value=c.value.filter(e=>e.id!==r),a.add("Rubro eliminado","success")}catch(e){throw console.error("Error deleting rubro:",e),a.add("Error al eliminar rubro","error"),e}}return{productos:o,rubros:c,unidades:f,tasasIva:g,proveedores:h,currentProducto:n,filters:b,loading:u,fetchProductos:E,fetchRubros:m,fetchUnidades:w,fetchTasasIva:A,fetchProveedores:P,fetchProductoById:x,createProducto:I,updateProducto:_,toggleEstado:R,createRubro:$,updateRubro:z,deleteRubro:S}});export{L as u};
